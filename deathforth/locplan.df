0 var 3-loc-stack

: cyoa-3-locs
	3-loc-stack sizes for 3-loc-stack drawcard next drop

	// cyoa-add-choice "CONTINUAR DIRIGINDO OU ALGO ASSIM" cyoa-choice-text!
;

: test-bar cyoa-add-choice "bar" cyoa-choice-text! ;
: test-mart cyoa-add-choice "mercearia" cyoa-choice-text! ;
: test-gunshop cyoa-add-choice "loja de armas" cyoa-choice-text! ;
: test-dingus choice( "Estrada de Cascalho" )choice: roadloot-gravel ;

: fchoice-card: fbold choice-card: ;
: rchoice-card: rbold choice-card: ;

deck-new
	"Mercearia Intacta" fchoice-card: grocery-death
	"Chale de Caca" fchoice-card: cabin1-huntlodge
	"Materiais Perigosos" fchoice-card: rare1-hazmat
	"Patrulheiros do Perigo" fchoice-card: rare1-rangers
	"Mestre de Kung Fu" fchoice-card: rare1-bruce
	"Local de Pouso de OVNI" fchoice-card: rare1-ufo
	"'Cabana do Eremita" fchoice-card: rare1-hermit
	"Animal Gigante" fchoice-card: rare1-hotdog
	"Casa Maliciosa" fchoice-card: rare1-altar
	"Fabrica Misteriosa" fchoice-card: rare1-factory
	"Museu" fchoice-card: rare1-museum
	"Cabanas de Pesca" fchoice-card: rare1-fish
	"Colegas do Ferro Velho" fchoice-card: rare1-junk
	"Bunker de Concreto" fchoice-card: rare1-bunker
	"Laboratorios Sinistros" fchoice-card: rare1-lab
	"Cemiterio Assombrado" fchoice-card: rare2-draculagrave
	"Inferno Furioso" fchoice-card: rare2-inferno
	"Fazenda Gotica" fchoice-card: rare2-farm
	"Mansao Assombrada" fchoice-card: rare2-ghostmansion
	"Amigo Congelado" fchoice-card: rare2-caveman
	"Deposito Militar" fchoice-card: liver-mbunker
value loc-pick-rare-base

loc-pick-rare-base shuffles var loc-pick-rare

: get-a-rare-loc loc-pick-rare
	depths 0= if loc-pick-rare-base shuffles to loc-pick-rare then
pops nip ;

// Maybe make the above draw nothing if it runs out? Or could have it draw a normal location instead, see trader shuffler for a defer example. Currently not changing it, as it's an impossible situation right now. Will change when we do endless.

: get-and-execute-rare-loc get-a-rare-loc execute ;

: rare-loc-number 3 gstats{ ugnome-rarelocs } 0 > if // 3 if no upgrades, up to 5 if maxed
	gstats{ ugnome-rarelocs } 2 > if 2 else 1 then else 0 then + ;

deck-new
	"Casarao" choice-card: inner7-cyoa
	"Apartamento Infestado" choice-card: inner8-cyoa // sorta hard, but not fully...
	"Cabana de Sobrevivencia" choice-card: cabin1-stash
	"Esconderijo na Floresta" choice-card: cabin1-night
	"Hotel Lotado" choice-card: inner4-cyoa
	"Casa Crivada de Balas" choice-card: inner6-cyoa
	"Fortaleza Perdida" rchoice-card: card4-cyoa // Same as Swarmed Apartment but harder
	"Cerco ao Posto de Gasolina" rchoice-card: siege1-gas
	"Quartel General da Policia" rchoice-card: policeHQ-cyoa
	"Invasao ao Hospital" choice-card: hospital-cyoa
	"Grande Complexo de Escritorios" choice-card: doubleoffice-cyoa
	"Escritorio Chique" choice-card: safeoffice-cyoa
	"Casa Elegante" choice-card: safeinhouse-cyoa
	"Casa Irritada" rchoice-card: maginhouse-cyoa // Designated hard due to aggression
	"Apartamento Irritado" rchoice-card: maginapt-cyoa
	"Apartamento de Ginastica" choice-card: gymapt-cyoa // Formerly Big Apartment, this is more descriptive
	"Arcade Morto" choice-card: bigarcade-cyoa
	"Mercearia" choice-card: grocery1
	"Grande Mercearia" choice-card: grocery2
	"Mercearia Lotada" rchoice-card: grocery3
	"Loja de Ferragens" choice-card: hardware
	"Yall Mart Lotado" choice-card: yallmart-mid
	"Yall Mart Mortal" rchoice-card: yallmart-hard
	"Livraria" choice-card: bookstore
	"Loja de Artigos Esportivos" choice-card: sporting
	"Fabrica Elegante" choice-card: indust-safe // actually Successful Factory
	"Rua Comercial" choice-card: 4commercial-cyoa
	"Pequeno Suburbio" choice-card: 4suburb-cyoa
	"Fileira de Apartamentos" choice-card: 4apartment-cyoa
	"Resgate de Apartamento" rchoice-card: rescueapt-cyoa
	"Resgate de Casa" rchoice-card: rescuehouse-cyoa
	"Resgate de Alimentos" rchoice-card: rescuegrocery
	"Resgate da Fabrica" rchoice-card: rescueindust
	"Resgate do Esgoto" rchoice-card: rescuesewer
	"Resgate na Estrada" rchoice-card: siege1-rescuerest
	"Resgate da Cabine" rchoice-card: siege1-rescuecabin
	"Resgate do Posto de Gasolina" rchoice-card: siege1-rescuegas
	"Resgate do Shopping" rchoice-card: rescuemall
	"Shopping" rchoice-card: malltest
	"Academia Infestada" rchoice-card: swarmgym-cyoa
	"Sala de Arquibancas Enjambada" rchoice-card: swarmarcade-cyoa
	"Pausa de Ancora" choice-card: rest-stop 
	"Pausa de Ancora Invadida" rchoice-card: rest-death // Roadside Nightmare
	"Pausa de Ancora com Carro" choice-card: rest-car // Roadside Car Stop
	"Cemiterio de Sucos" choice-card: junk-car // Junkyard Car Parking
	"Cemiterio de Sucos" choice-card: junk-loot
	"Cemiterio de Sucos Seguro" choice-card: junk-safe
	"Cabana com Carro" choice-card: cabin1-car // Car Rental Cabin
	"Linha Urbana com Carro" choice-card: houserow-car // Free Car!
	"Casa em Chamas" rchoice-card: burnhouse
	"Quinta Tranquila" choice-card: farm-toolbarn
	"Resgate de Grangeiro" rchoice-card: farm-pigbarn
	"Mansao Sombria" rchoice-card: darkmansion
	"Cemiterio com Carro" rchoice-card: mandible-graveyard
	"Parque Ocupado com Carro" rchoice-card: mandible-crowded
	"Parque Publico" choice-card: mandible-park
	rare-loc-number cards: get-and-execute-rare-loc
value loc-pick-stack-base

loc-pick-stack-base shuffles var loc-pick-stack

deck-new
	"Hotel Tranquilo" choice-card: inner3-cyoa
	"Casa na Estrada" choice-card: inner5-cyoa
	"Pausa de Ancora" choice-card: rest-easy
	"Yall Mart" choice-card: yallmart-easy
	"Fabrica Tranquila" choice-card: indust-easy
value easyloc-pick-stack-base

easyloc-pick-stack-base shuffles var easyloc-pick-stack

: get-a-loc loc-pick-stack
	depths 0= if loc-pick-stack-base shuffles to loc-pick-stack then
pops nip ;

: get-a-loc-easy easyloc-pick-stack
	depths 0= if easyloc-pick-stack-base shuffles to easyloc-pick-stack then
pops nip ;

: explorer-pick
	explorer? if drop 3 else drop 
		10 %chance if 3 else 2 then
	then 
;

: pick-3-locs 
	explorer-pick stack sizes for get-a-loc shove next to 3-loc-stack
	cyoa-3-locs
;

: pick-3-locs-easy 3 stack sizes for get-a-loc-easy shove next to 3-loc-stack
	cyoa-3-locs
;

: locpick-redrawcost road{ car-guzzle 2.5 * } >int ;

: explorer-redrawcost 
	gstats{ perk-explorer } 3 >= if
		road{ car-guzzle 1.5 * } >int
	else 
		gstats{ perk-explorer } 2 >= if
			road{ car-guzzle 2 * } >int
		else
			locpick-redrawcost
		then
	then
;

: locpick-repick
	cyoa-start
	"Dirigindo por Toda Parte" cyoa-title!
	($ Thegroup .. "  decide queimar um pouco de gasolina na esperanca de encontrar lugares mais interessantes. " .. gThey .. "  encontrar" .. g1s .. "  alguns novos locais: " $) text!
	locpick-redrawcost -1 * trunk-gas+ -1 car-tune+
	pick-3-locs
	gas-skip
;

: explorer-repick
	cyoa-start
	"Exploracao Cuidadosa" cyoa-title!
	($ Thegroup .. "  leva mais tempo para explorar. " .. gThey .. "  encontrar" .. g1s .. "  alguns novos locais: " $) text!
	explorer-redrawcost -1 * trunk-gas+ -1 car-tune+
	pick-3-locs
	gas-skip
;

: locpick
	cyoa-start
	"Sempre estar saqueando" cyoa-title!
	($ "Enquanto dirigia na Estrada da Morte " .. thegroup .. " decide fazer uma parada para suprimentos " $) text!
	pick-3-locs
	explorer? if drop
		trunk-gas explorer-redrawcost 1 - > if
			choice( "Explorador " pbold .. "Dirija mais   " .. explorer-redrawcost .. " gasolina"  )choice: explorer-repick
		else
			gas-skip
		then
	else drop
		trunk-gas locpick-redrawcost 1 - > if
			choice( "Dirija mais por ai   " .. locpick-redrawcost .. " gasolina"  )choice: locpick-repick
		else
			gas-skip
		then
	then
;

: easylocpick
	cyoa-start
	"Embarcando na Estrada da Morte" cyoa-title!
	($ "Para comecar a jornada " .. thegroup .. " 'decide pegar alguns suprimentos em um local proximo.		Para sobreviver na Estrada da Morte, voce precisara acumular o maximo de suprimentos possivel! Voce tambem precisara encontrar maneiras de treinar e aumentar sua equipe." $) text!
	// Temp Testing
	// choice( "Amigo Congelado" fbold )choice: rare2-caveman
	pick-3-locs-easy
	explorer? if drop
		easyloc-pick-stack drawcard
	then
;
	
(* AUTO CHOICE DECK EXAMPLE

deck-new 
	"Pausa de Ancora" choice-card: beep ( <- the choice handler, i.e. rest-stop )
value choices-list

: test-cyoa cyoa-start choices-list drawcard ;

;

*)
