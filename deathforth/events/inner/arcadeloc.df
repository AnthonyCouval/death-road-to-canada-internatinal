		
cyoa{		

cyoa-choice: arcade-vidcon2
	($ cname .. "  fangt an, den Arcade Automaten auseinanderzunehmen, um zu sehen, wie er funktioniert. Nach einigem Herumstobern, " .. che .. "  findet den Grund heraus. Es stellt sich heraus dass all diese alten Arcade Automaten mit Gas betrieben werden! " .. cname .. "  lasst vorsichtig das Gas aus seinem Fach ab." $) cyoa-text!
	goodfx 40 70 rnd LOOT_GAS spawnloot clear-cyoa
;

: arcade-names
	1 6 rnd case
		1 of "TODESSTRASSE NACH KANADA" endof
		2 of "TODESSPRITZER" endof
		3 of "TODESANHAUCH" endof
		4 of "POLYBIUS" endof
		5 of "TODESEXPLOSIV" endof
		6 of "U*L*T*R*A*T*O*D" endof
	endcase
;
		
cyoa-choice: arcade-vidcon1
	($ cname .. "  spielt ein altes Arcade Spiel namens " .. arcade-names fbold .. "  und geht darin richtig auf. Wie bei allen Videospielen, die jemals gemacht wurden, verbessert das Spielen deine Fahigkeiten mit Waffen. Die Kritiker hatten Recht. Bevor " .. cname .. "  es wusste, waren 2 Stunden vergangen." $) cyoa-text!
		shootingREV shooting++ morale++ goodfx
		clear-cyoa
		o'clock@ 2 + o'clock 
		team-nearby? not if	
			($ "Es war niemand da der sie verteidigen konnte " .. pname .. "  also musste " .. phe .. "  sich beim Spielen gegen Zombies wehren. Vorsicht!" $) +crtext
			7 13 rnd roomgen{ .zombspawn }
		then
;

cyoa: arcade-vidcon
	"Arcade Pause" cyoa-title!
	picon!
	"'Dieser Arcade Automat scheint zu funktionieren! Es ist nicht ganz klar wie er ohne Strom laufen kann." cyoa-text!
	chumany? not if
		($ pname .. " ' starrt verwirrt auf den Arcade Automaten. Was Menschen von Tieren unterscheidet, ist vor allem, dass Tiere keine Videospiele spielen. Zumindest meistens." $) +crtext
	then; 
	team-nearby? not if
		($ "Da es in der Nahe niemanden gibt, dem man vertrauen kann, konnte es gefahrlich sein, es zu spielen." $) +crtext
	else
		($ pname .. "  uberlegt eine Videospielpause zu machen wahrend " .. phe .. "  bewacht wird." $) +crtext
	then
		pchar charchoice( "  spielt das Arcade Spiel" )choice: arcade-vidcon1
		cmechanic+ if
			pchar charchoice( "  zerlegt den Arcade Automaten" )choice: arcade-vidcon2
		then
	choice( "Lass es erstmal so" )choice
;

}
			
map{ roomgen{
	
: gachapon
	spawn special_objects32_base_id 0x 5
	+ lt .spriteid! rndflip
	25 health! bbox openable swolebolt- as-metal
;
: gachaempty gachapon opened ;
	
: arcademachine
	spawn special_objects32_base_id 0x 8 + lt .spriteid!
	30 health! bbox swolebolt+ as-metal
;
: gasarcademachine
	spawn special_objects32_base_id 0x 27 + lt .spriteid!
	 30 health! bbox swolebolt+ as-metal
;


: arcade-events args( me eventid )
	<- eventid THING_EVENT_TIMER <> if then;

	// CRT scanlines
	<- me .pos particle{ new pos!
		special_objects32_base_id 0x 98 + <- me .anim.state@ + spriteid!
		<- me .anim.state@ not <- me .anim.state!
		5 ticks!
		0.3 clr.a!
		0.5 clr.r!
		0.5 clr.g!
		1 clr.b!
		0 global_colour!
	}

	// blink PLAY <ALIEN>
	<- me .anim.substate@ 1+ dup <- me .anim.substate!
	4 & if
		<- me .pos particle{ new pos!
			special_objects32_base_id 0x 9a + <- me .anim.substate@ 3 >> 1 & + spriteid!
			5 ticks!

			<- me .anim.substate@ 45 * angle-colour rgb!

			0 global_colour!
		}
	then

	5 <- me .timer!
;

: arcade-on
	gasarcademachine cyoa{ ' arcade-vidcon cyoa! }
	' arcade-events events!
	5 lt .timer!
;

: smallarcade
	spawn special_objects32_base_id 0x c + lt .spriteid!
	15 health! bbox 5bolt as-metal
;

: clawmachine
	spawn special_objects32_base_id 0x d 
	80 %chance if 1 + then
	+ lt .spriteid! rndflip
	15 health! bbox 4bolt as-metal
;
	
} }

locdef{ 
		
location: arcade
		max-rooms: 2
		entry-tags: arcade
		script: set-theme-arcade

		room-choice: arcade-play
			room-weight: 10
			room-count: 1
			room-script: 
			room-post-script: 10diff %zombs map{ room-garbage }
			filter-only		

		room-choice: restroom
			room-weight: 10
			room-count: 1
			room-script: floor-bath
			
}
