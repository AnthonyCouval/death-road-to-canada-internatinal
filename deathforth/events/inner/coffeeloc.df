cyoa{

: coffeed pchar statmod{ dup .coffee .untired } ;
: coffeed? pchar statmod{ .coffee? } ;

cyoa-choice: coffee-get2
	($ cname .. "  utilise toutes " .. chis .. "  competences mecaniques pour comprendre a quoi servent les nombreux boutons de la cafetiere.	" .. cHe .. " ' prepare la tasse de cafe parfaite! Cest delicieux!	La machine a cafe emet des etincelles, de la fumee et meurt." $) cyoa-text!
		coffeed	pchar statmod{ .unsick }
		morale2+ dexterity++ goodfx clear-cyoa mechanicREV
;

cyoa-choice: coffee-get1
	pchar statmod{ .sick? } if
		($ cname .. " ' se sent trop malade pour savourer un cafe qui est reste dans une machine pendant des annees." $) cyoa-text! badfx 50 %chance if sting-- then
	then;
	coffeed? if
		($ cname .. " ' boit ENCORE PLUS de cafe et se sent ensuite plutot malade. 		Difficile de dire si cest a cause de la grande quantite de cafeine, des tasses sales ou du cafe qui pourrit depuis on ne sait combien de temps." $) cyoa-text! badfx pchar statmod{ dup .sick .uncoffee }
	else
		($ cname .. "  vaporise du cafe dans une vieille tasse qui trainait et le boit.		" .. cHe .. " ' se sent tout a fait COFFEE'D UP." $) cyoa-text!
			goodfx coffeed
	then
;

cyoa: coffee-get
	"Cafe apocalyptique" cyoa-title!
	picon!
	"'Cette enorme et complexe machine a cafe a ete concue pour survivre a differents types de scenarios de fin du monde. C'etait une grande partie de la campagne marketing de ce cafe. Verite dans la publicite, ca marche toujours!" cyoa-text!
	chumany? not if
		($ pname .. "' n'a pas la moindre idee de comment faire fonctionner cette chose. Et vraiment, " .. cdogcat .. "' ne devrait pas boire de cafe de toute facon." $) +crtext	
	then;
		pchar charchoice( "  prend du CAFE" )choice: coffee-get1
		cmechanic+ if
			pchar charchoice( "  joue avec les parametres" )choice: coffee-get2
		then
	choice( "Laisse le tranquille" )choice
;

}
		
map{ roomgen{

: coffeemachine
	spawn special_objects48_base_id 0x 6 + lt .spriteid!
	rndflip bbox immovable as-metal
	cyoa{ ' coffee-get cyoa! }
;
} }

locdef{
	
location: coffee
		max-rooms: 2
		entry-tags: coffee
		script: set-theme-restaurant

		room-choice: coffee
			room-weight: 10
			room-count: 1
			room-script: 
			room-post-script: 10diff %zombs map{ room-garbage }
			filter-only		

		room-choice: restroom
			room-weight: 10
			room-count: 1
			room-script: floor-bath
			
}