uses paul/region-layout.df
uses paul/region-road-layout.df
// uses events/industrial/indust.df
// "../deathforth/rooms/TEMPROOM.txt" $load-rooms
	
" 
:map 2 
:tags roboshack  
:scriptA roboprof
:scriptB robopunch 
:scriptC robospeed 
:scriptD indwalls 
:scriptE indbluepanel 
:scriptF indgreenpanel 
:scriptG 3indwalls 
:size 11 12 
:off 1 1 
:tiles 
00222222200
00233333200
00211D11200
2221E1F1222
23311A11332
21111111112
21B11111C12
21111111112
22221112222
33321112333
00022222000
00033333000

:map 3 
:tags toolshop  
:scriptA tshopgas 
:scriptB tshopelec 
:scriptC cashcounter flipside 
:scriptD cashcounter 
:scriptE indshelf -1 movey 
:scriptF industsmall 
:size 15 13 
:off 6 0 
:tiles 
222222202222222
233333202333332
21E1E12021E1E12
2F111F202F111F2
222122222221222
332133333331233
00211C111D11200
002A1111111B200
002111111111200
002111111111200
002222111222200
003332222233300
000003333300000

:map 4 
:tags toolschool  
:scriptA schooltrader 
:scriptB industsmall 
:scriptC carwreck 
:scriptD indshelf -1 movey 
:scriptE 3indwalls 
:size 13 11 
:off 6 1 
:tiles 
2222222222222
2333333333332
2B1D1D111E112
2B1111111C112
211111A111112
2111111111BB2
2B111111111B2
2BB111111B112
2222211122222
3333222223333
0000333330000
"
value CAMP
CAMP $parse-rooms

cyoa{

: cyoa-sale-car
	carkey 0 > if cyoa-car then;

	cyoa-start
	"Carro a venda" cyoa-title!
		"'Este carro parece estar 'pronto para uso e pronto para uso'.		Voce pode compra lo do vendedor de carros desprezivel proximo!" cyoa-text!
		choice( "Volte mais tarde" )choice
		

;

cyoa-choice: tcarsales-go
	($ Thegroup .. "  compra um carro novo em folha!" .. "Pode pegar qualquer carro que quiser!" pbold $) cyoa-text! goodfx
		1 to carkey clear-cyoa -5 trunk-food+ 50 trunk-gas+ someicon
;

cyoa: tcarsales
	"Todo Carro Deve Ir!" cyoa-title!
	($ "'Eu preciso tirar esses carros do patio! Voce pode comprar qualquer carro, agora mesmo, pelo preco baixo e baixo de 5 alimentos! Compre agora! Sem financiamento! Pronto para uso e pronto para uso! Eu ate colocarei 50 de gasolina!" pbold $) cyoa-text!
	trunk-food 4 > if "'Isso e um bom negocio." +crtext then
	basic-tone foodamt
	trunk-food 5 < if
		($ Thegroup .. " ' nao posso pagar pela compra de um carro novo e brilhante que mudara sua vida." $) +crtext
	else
		choice( "Va embora por enquanto" )choice back-esc
		trunk-food 4 > if
			choice( "Compre um carro novo   5 alimentos" )choice: tcarsales-go
		then
	then
;

cyoa-choice: tgarage-1
	($ Thegroup .. "  paga por reparos completos de chassi e motor!" .. "'Quando voce sair daqui, basta dirigir seu carro um pouco mais adiante e nos o consertaremos!" pbold $) cyoa-text! goodfx
		clear-cyoa -5 trunk-food+ image-car-garage road{ ' mandible-repairgarage stack-road-action }
;

cyoa-choice: tgarage-2
	($ Thegroup .. "  paga por uma serie de modificacoes avancadas no carro, alem de reparos completos de chassi e motor!" .. "Quando voce sair daqui, basta dirigir um pouco mais adiante ate a garagem. Seu carro recebera AS OBRAS!" pbold $) cyoa-text! goodfx
		clear-cyoa -35 trunk-food+ image-car-garage road{ ' mandible-megagarage stack-road-action }
;

cyoa: tgarage
	"Garagem Especializada" cyoa-title!
	($ "Temos uma garagem cheia de mecanicos especializados logo abaixo da estrada e oferecemos " pbold .. "AS OBRAS" fbold .. ". Mods de carro completo: Blindagem, aumento de velocidade, chassi reforcado, revisao do motor com maior eficiencia de combustivel. Tudo por 35 alimentos. Tambem podemos consertar totalmente seu carro sem mods doces, por 5 alimentos." pbold $) cyoa-text!
	trunk-food 34 > if "O carro perfeito e possivel." +crtext else
		trunk-food 4 > if "Voce ainda pode comprar reparos completos." +crtext then
	then
	basic-tone foodamt
	trunk-food 5 < if
		($ Thegroup .. " 'nao pode pagar por esta modificacao de carro tao extensa mas de bom gosto." $) +crtext
	else
		choice( "Va embora por enquanto" )choice back-esc
		trunk-food 34 > if
			choice( "Modificacoes Completas do Carro, " .. "AS OBRAS" fbold .. "    35 comida" )choice: tgarage-2
		then
		trunk-food 4 > if
			choice( "Reparos Completos   5 comida" )choice: tgarage-1
		then
	then
;

0 value mt1-1
0 value mt1-2
0 value mt1-3
0 value mt1-4

cyoa-choice: trade-m1-4
	($ Thegroup .. " compra uma britadeira a gas!	" .. "'A escolha do conhecedor para cinzelar hordas de zumbis!" pbold $) cyoa-text! goodfx
	1 WEAPON_JACKHAMMER trunk.weapon+ -20 trunk-food+ someicon ' mt1-4 ++
;

cyoa-choice: trade-m1-3
	($ Thegroup .. " compra uma motosserra a gas! Um classico!	" .. "'Todo mundo sabe que esta e A resposta para zumbis! Contanto que voce nao fique sem gasolina." pbold $) cyoa-text! goodfx
	1 WEAPON_CHAINSAW trunk.weapon+ -10 trunk-food+ someicon ' mt1-3 ++
;

cyoa-choice: trade-m1-2
	($ Thegroup .. " compra um soprador de folhas a gas!	" .. "Afaste os zumbis! Como folhas!" pbold $) cyoa-text! goodfx
	1 WEAPON_BLOWER trunk.weapon+ -5 trunk-food+ someicon ' mt1-2 ++
;

cyoa-choice: trade-m1-1
	($ Thegroup .. " compra um cortador de ervas daninhas a gas!	" .. "Excelente para aparar as hordas de zumbis! Um tanto decente para ervas daninhas." pbold $) cyoa-text! goodfx
	1 WEAPON_WHACKER trunk.weapon+ -5 trunk-food+ someicon ' mt1-1 ++
;

cyoa: tshopgas
	"Ferramentas a Gas" cyoa-title!
	($ "D" pbold $) cyoa-text!
	trunk-food 4 > if "Hora de acelerar." +crtext then
	basic-tone foodamt
	trunk-food 5 < if
		($ Thegroup .. " trader gives you gas" $) +crtext clear-cyoa +30 trunk-gas+ goodfx
	else
		choice( "Va embora por enquanto" )choice back-esc
		trunk-food 19 > mt1-4 1 < and if
			choice( "20 food" )choice: trade-m1-4
		then
		trunk-food 9 > mt1-3 3 < and if
			choice( "10 wood" )choice: trade-m1-3
		then
		trunk-food 4 > mt1-2 3 < and if
			choice( "Leaf blower" )choice: trade-m1-2
		then
		trunk-food 4 > mt1-1 3 < and if
			choice( "Weed Whacker   5 comida" )choice: trade-m1-1
		then
	then
;

0 value mt2-1
0 value mt2-2
0 value mt2-3
0 value mt2-4

: mt2-firstbuy 
	mt2-4 1 < mt2-3 1 < mt2-2 1 < mt2-1 1 < and and and
;

: mt2-firstbuy-done
	($ "Aproveite o seu " pbold .. "DUPLA COBRANCA!" fbold $) +crtext
;

cyoa-choice: trade-m2-4
	($ Thegroup .. "  compra uma britadeira eletrica!	" .. "'E tao ecologicamente correto!" pbold $) cyoa-text! goodfx
	mt2-firstbuy if mt2-firstbuy-done 255 else 130 then WEAPON_EJHAMMER trunk.weapon+ -20 trunk-food+ someicon ' mt2-4 ++ ;

cyoa-choice: trade-m2-3
	($ Thegroup .. "  compra uma motosserra eletrica! Voce se sente desconfortavelmente presuncoso por salvar o meio ambiente no pos apocalipse.	" .. "Excelente para compostagem de zumbis!" pbold $) cyoa-text! goodfx
	mt2-firstbuy if mt2-firstbuy-done 160 else 80 then WEAPON_ECHAINSAW trunk.weapon+ -10 trunk-food+ someicon ' mt2-3 ++ ;
	
cyoa-choice: trade-m2-2
	($ Thegroup .. "  compra um soprador de folhas eletrico!	" .. "Conduza os zumbis gentilmente, uma alternativa pacifista a toda essa carnificina!" pbold $) cyoa-text! goodfx
	mt2-firstbuy if mt2-firstbuy-done 100 else 50 then WEAPON_EBLOWER trunk.weapon+ -5 trunk-food+ picon ' mt2-2 ++ ;

cyoa-choice: trade-m2-1
	($ Thegroup .. "  compra um cortador de grama eletrico!	" .. "Tem varios usos eficazes nos metodos de cultivo de Zombocultura." pbold $) cyoa-text! goodfx
	mt2-firstbuy if mt2-firstbuy-done 100 else 50 then WEAPON_EWHACKER trunk.weapon+ -5 trunk-food+ picon ' mt2-1 ++ ;

cyoa: tshopelec
	"Ferramentas eletricas" cyoa-title!
	($ "'Nao fale com o outro cara! As ferramentas eletricas sao ecologicas, permitindo que voce reduza as emissoes de gas ao derrubar zumbis." pbold $) cyoa-text!
	basic-tone foodamt
	trunk-food 5 < if
		($ Thegroup .. " nao tem comida suficiente para comprar nada!" $) +crtext
		($ "O comerciante tem pena de " .. thegroup .. " e entrega um " .. "DESCONTO SOPLADOR DE FOLHAS!" rbold $) +crtext goodfx 30 WEAPON_EBLOWER trunk.weapon+ clear-cyoa
	else
		mt2-firstbuy if
			($ "Como um negocio especial, o comerciante ira " .. "DUPLA COBRANCA" rainbold .. "  sua primeira compra. Tera o dobro de energia do que voce normalmente encontraria!" $) +crtext
		then
		choice( "Va embora por enquanto" )choice back-esc
		trunk-food 19 > mt2-4 1 < and if
			choice( "Marreta eletrica   20 alimentos" )choice: trade-m2-4
		then
		trunk-food 9 > mt2-3 2 < and if
			choice( "Motosserra eletrica   10 alimentos" )choice: trade-m2-3
		then
		trunk-food 4 > mt2-2 2 < and if
			choice( "Soprador de folhas eletrico   5 alimentos" )choice: trade-m2-2
		then
		trunk-food 4 > mt2-1 2 < and if
			choice( "Cortador de ervas daninhas eletrico   5 alimentos" )choice: trade-m2-1
		then
	then
;

0 value mechtrained+

: mech-train-amt numhums 2 * mechtrained+ 1 + * 1 + ; 
: mech-train-pay? trunk-food mech-train-amt 1 - > notsolo notsolohuman and and ;
: mech-train-pay mech-train-amt -1 * trunk-food+ ;

: mech-solo-amt mechtrained+ 2 * 3 + ;
: mech-solo-pay? trunk-food mech-solo-amt 1 - > ;
: mech-solo-pay mech-solo-amt -1 * trunk-food+ ;

cyoa-choice: mech-school-train
	cchar .mechanical@ 6 < if
		($ cname .. " ' observa atentamente enquanto o Professor realmente bate no carro com uma chave inglesa. Entao E ISSO que e engenharia!" $) goodfx
	else
		($ cname .. "  ja obteve seu diploma completo de engenharia desta prestigiada academia! Seu ultimo pagamento e recebido como uma doacao para construir uma nova ala para a escola." $) badfx
	then cyoa-text! 
	mech-solo-pay mechanicREV mechanic++ ' mechtrained+ ++
;

cyoa-choice: mech-school-group
	($ "'O grupo inteiro recebe treinamento mecanico! Todos observam o Professor bater no carro com uma chave inglesa. E muito esclarecedor." $) cyoa-text! goodfx
	mech-train-pay someicon
	regiondef{ ' trade-mechanic-group! foreach-human-char } numhums ' mechtrained+ +!
;

cyoa: mech-school-give
	solohuman if
		choosehuman mech-school-train
	then;
	"Quem deveria obter esse vasto conhecimento mecanico?" cyoa-text!
	' mech-school-train cyoa-human-choice
;

cyoa: schooltrader
	($ "A Escola de Ferramentas" $) cyoa-title!
	"A engenharia mecanica e uma verdadeira ciencia. Ao contrario da medicina, que e mais uma arte. Semelhante ao Origami, ou talvez a danca interpretativa." pbold text!
	"O Professor de Mecanica bate repetidamente no chassi do carro destruido com uma chave inglesa enquanto diz isso, nunca quebrando o contato visual." +crtext foodamt
		mech-solo-pay? not if
			"' Voce nao pode pagar por mais nenhum treinamento." +crtext 
		then;
		choice( "Va embora por enquanto" )choice back-esc
		mech-solo-pay? if
			choice( "De " .. mech-solo-amt .. "  comida para um unico treinamento" )choice: mech-school-give
		then
		mech-train-pay? if
			choice( "De " .. mech-train-amt .. "  alimentos para treinamento em grupo" )choice: mech-school-group
		then
		
;

cyoa-bridge: robopunch-go
	ricon 4 recruitee .morale! clear-cyoa 0.25 recruitee .ai.wander_chance! 0 nearest .unseen!
	10 recruit-yes-food 
	($ "Um robo que distribui surras? A tecnologia e muito legal." $) +crtext
	"portugues" pbold +crtext
	recruitee .strengthREV recruitee .fitnessREV
;

cyoa: robopunch
	"O Perfeito Soco Mecanico" cyoa-title!
	nearest .character@ choosechar cchar to recruitee ricon
	"#EU SOU O ROBO DE SOCOS#" pbold cyoa-text! basic-tone
	"Agora estamos indo a algum lugar! Este robo foi projetado para um unico proposito: socar." +crtext
	trunk-food 9 > if
		choice( "Deixe para depois" )choice
		choice( "1 PUNCHBOT" )choice: robopunch-go
	else
		"Voce precisa de 10 alimentos para comprar este robo de soco." +crtext
		choice( "Nao posso poupar a comida" )choice
	then
;

cyoa-bridge: robospeed-go
	ricon 4 recruitee .morale! clear-cyoa 0.25 recruitee .ai.wander_chance! 0 nearest .unseen!
	15 recruit-yes-food 
	($ "O robo faz um donut bem rapido. Tao rapido." $) +crtext
	"#VELOCIDADE DE CARREGAMENTO PROTOCOLOS#	#TEM QUE IR RAPIDO#" pbold +crtext
	recruitee .strengthREV recruitee .fitnessREV
;

cyoa: robospeed
	"Tao Rapido" cyoa-title!
	nearest .character@ choosechar cchar to recruitee ricon
	"#SOU O BOT SPEED#" pbold cyoa-text! basic-tone
	"'Com suas linhas elegantes e minusculas calotas giratorias, mesmo parado, este robo exala o conceito de velocidade. Alem disso, ele acabou de dizer a palavra velocidade." +crtext
	trunk-food 14 > if
		choice( "Deixe para depois" )choice
		choice( "Compre SPEEDBOT   15 comidas" )choice: robospeed-go
	else
		"Voce precisa de 15 comidas para comprar este speed bot." +crtext
		choice( "Nao posso poupar a comida" )choice
	then
;

}

roomgen{


: .ct1 args( ch ) // Mech Teacher
	WEAPON_WRENCH <- ch .weapona!
;
: .ct2 args( ch ) // Gas tools
	26 <- ch .glassestype! // Gas Mask
;
: .ct3 args( ch ) // Elec tools
	21 <- ch .glassestype! // Green Goggles
;
: .ct4 args( ch ) // Garage
	1 <- ch .female!
	25 <- ch .hattype!
	6 <- ch .legstype!
	3 <- ch .torsotype!
	0 <- ch .glassestype!
;
: .ct5 args( ch ) 
	7 <- ch .hattype! // Cowboy hat
;
: .ct6 args( ch ) 
	<- ch .speedbotify
;
: .ct7 args( ch ) 
	<- ch .punchbotify
;

: camptradercommon
	still-npc regiondef{ ' trader-event lt .events! 1 lt .timer! }
	
;

: schooltrader
	camptradercommon .ct1 cyoa{ ' schooltrader cyoa! }
;

: robopunch
	camptradercommon .ct7 cyoa{ ' robopunch cyoa! }
;

: robospeed
	camptradercommon .ct6 cyoa{ ' robospeed cyoa! }
;

: roboprof
	// camptradercommon .ct8 cyoa{ ' roboprof cyoa! }
;

: tshopgas
	camptradercommon .ct2 cyoa{ ' tshopgas cyoa! }
;

: tshopelec
	camptradercommon .ct3 cyoa{ ' tshopelec cyoa! }
;

: tgarage
	camptradercommon .ct4 cyoa{ ' tgarage cyoa! }
;

: tcarsales
	camptradercommon .ct5 cyoa{ ' tcarsales cyoa! }
;

		0 stack
			' camptradercommon shove
			' camptradercommon shove
			' camptradercommon shove
			' camptradercommon shove
		value preptrader-base
		preptrader-base shuffles var preptrader-picker

: preppertrader
	preptrader-picker depths 0= if preptrader-base shuffles to preptrader-picker then pops nip execute ;


}

locdef{

location: toolshop
		max-rooms: 1
		entry-tags: toolshop
		script: set-theme-restaurant
		pre-script: set-theme-restaurant
		post-script: nad 0 %zombs
				
		room-choice: toolshop
			room-weight: 10
			room-count: 1
			room-post-script: 
			filter-only
			
location: toolschool
		max-rooms: 1
		entry-tags: toolschool
		script: set-theme-bookstore
		pre-script: set-theme-bookstore
		post-script: nad 0 %zombs
				
		room-choice: toolschool
			room-weight: 10
			room-count: 1
			room-post-script: 
			filter-only
		
location: roboshack
		max-rooms: 1
		entry-tags: roboshack
		script: factory-theme
		pre-script: factory-theme
		post-script: nad 0 %zombs
				
		room-choice: roboshack
			room-weight: 10
			room-count: 1
			room-post-script:
			filter-only
			
}
		
root{

: prepper-magchance
	20 %chance if
		magazine 0 4 rnd cyoa{ to bookmagtype ' bookmag-get cyoa! } 50 health! drift
	then
;

: sale-car 
	1 22 rnd spawncar mission{ cyoa{ ' cyoa-sale-car cyoa! } }
	0 lt .action_icon!
;

}
		
map{ regiondef{

trade-camp-reset

0 value gbx
0 value gby
0 value gbx2
0 value gby2
0 value gbx3
0 value gby3
0 value bfx
0 value bfy

: bldg tanchor!
	"barraca de robos" $picklocid addloc
	"BARRACA DE ROBOS" sign-text! prefab{ 1 5 1 shop } 
;
: bldg2 tanchor!
	"loja de ferramentas" $picklocid addloc
	"LOJA DE FERRAMENTAS" sign-text! prefab{ 2 5 1 shop } 
;
: bldg3 tanchor!
	"escola de ferramentas" $picklocid addloc
	"ESCOLA DE FERRAMENTAS" sign-text! prefab{ 3 6 1 shop } 
;


' plotgrass >defer ft

: pt
	xyp.xy ft // Plot the current floor by default
	
	xyp.i char { = if xyp.xy to gby2 to gbx2 then;
	xyp.i char } = if gbx2 1- gby2 xyp.xy swap 1+ swap gravellot then;
	xyp.i char ( = if xyp.xy to gby to gbx then;
	xyp.i char ) = if gbx 1- gby xyp.xy swap 1+ swap gravellot then;
	xyp.i char [ = if xyp.xy to gby3 to gbx3 then;
	xyp.i char ] = if gbx3 1- gby3 xyp.xy swap 1+ swap gravellot then;
	
	xyp.i char 1 = if xyp.x to bfx then;
	xyp.i char 2 = if bfx xyp.y xyp.x barbfence then;

	xyp.i char t = if sale-car lt-here then;
	xyp.i char U = if tnomey-spawn then;
	xyp.i char W = if trader-weapon-buyer then;
	xyp.i char G = if trader-food-for-gas then;
	xyp.i char S = if tgarage lt-here then;
	xyp.i char M = if tcarsales lt-here then;
		
	xyp.i char @ = if xyp.xy bldg then;
	xyp.i char 3 = if xyp.xy bldg2 then;
	xyp.i char 4 = if xyp.xy bldg3 then;
	
	xyp.i char p = if ' plotpave to ft then;
	xyp.i char $ = if xyp.xy grassedge then;
;

"
...........................
1.........................2
...........................
..................[....t...
...........................
...........................
...........................
.......L..........ML...t...
..{........................
.@....3....4...............
...........................
............(...}......t...
..................S........
...........................
..........................]
...........................
1..........2....1.........2
......G..U...........W....p
$$$$$$$$$$$$....$$$$$$$$$$$
...............)...........
...........................
...........................
...........................
...........................
...........................
...........................
..........................."
constant maplayout

: specialcamp-6
	' plotgrass to ft
	0 -1 maplayout xyplot: pt
;


: site-setup

	// Clear the map with grass
	-1 -1 w h grassbox

	pavement
// Plot trader stuff
	specialcamp-6

	-1 -1 w 3 conclot // Top
	-1 h 2 - w h conclot // Bottom

	0 h 6 - w ' plotroadlines hline
	

	1 no_time!
	7 14 rnd o'clock
	// 50 %chance if 1 2 frnd weather! -1 -2 frnd wind_force! else 1 2 frnd wind_force! then
	
	mission{ no-edge-spawns }
	
	20 %mv-up
	25 %chars-up
;

	 region: specialcamp-6
		w: maplayout layoutw
		h: maplayout layouth

		trade-mode

		post-script: site-setup
} }
