uses paul/region-layout.df

"events/inner/arcadeloc.df" $load

"
:map 1
:tags traderarcade  
:scriptA arcademachine -1 movey 
:scriptB cashcounter -1 movey 0.2 movex
:scriptC traderarcade-npc -0.5 movey 0.4 movex
:scriptD traderarcade-shoot -1 movey 
:scriptE traderarcade-rp -1 movey 
:scriptF clawmachine -1 movey
:scriptG traderarcade-fire -1 movey
:scriptH traderarcade-axe -1 movey
:size 14 9 
:off 8 0 
:tiles 
22222222222000
23333333332222
2AEADFGAHA3332
21111111111112
2111111111BC12
21111111111112
21111111111112
22222222222222
33333333333333
"
value TRADERARCADE
TRADERARCADE $parse-rooms

locdef{

location: traderarcade
		max-rooms: 1
		entry-tags: traderarcade
		pre-script: yall-theme
		script: yall-theme
		post-script: 
		
		room-choice: traderarcade
			room-weight: 10
			room-count: 1
			room-script: ndx 
			room-post-script:
			filter-only

}

cyoa{

// Shooting Arcade Machine

0 value traderarcade-shoot+

: traderarcade-amt traderarcade-shoot+ 2 * 2 + ;
: traderarcade-pay? trunk-food traderarcade-amt 1 - > ;
: traderarcade-pay traderarcade-amt -1 * trunk-food+ ;

cyoa-choice: traderarcade-mech
	($ "EH! DEJA LA MAQUINA DE JUEGOS DE LA GALERIA, NERD!" bbold $) text!
	"El trabajador del arcade no esta feliz." +crtext
	($ cname .. " se estremece." $) +crtext 
	mechanicREV badfx
;

cyoa-choice: traderarcade-shoot-go
	($ cname .. " 1. " .. che .. " 0.0 " .. cname .. "su mente. Aun no hay pista sobre que juego de arcade sea realmente." $) cyoa-text!
		shootingREV shooting++ goodfx traderarcade-pay ' traderarcade-shoot+ ++
;

cyoa: traderarcade-shoot
	"Juego arcade misterioso" cyoa-title!
	picon!
	($ "Esta maquina recreativa tiene su ranura de moneda reemplazada por una gran cubeta que dice ', " .. "INTERSE AQUI" rbold .. " ' arriba. Que juego esta supuestamente para ser, solo hay una cosa en pantalla: un mensaje que dice: ', " $) cyoa-text!
	($ "SIGUIENDO: ', " fbold .. traderarcade-amt rainbold .. " ' COMIDA" rainbold $) +text
	+cr foodamt
	chumany? not if
		($ pname .. " ' La zorra mira a la maquina recreativa con perplejidad. Los animales en general no juegan videojuegos, excepto en algunas excepciones. Por ejemplo, las lombrices pueden jugar juegos de caminata, aunque no entiendan el sublime genio de la narracion." $) +crtext
	then;
		traderarcade-pay? not if
			"No puedes permitirte esto." +crtext 
		then;
	choice( "Dejarlo para otro momento" )choice
	pchar charchoice( " 'juega durante ', " .. traderarcade-amt .. " 'comida" )choice: traderarcade-shoot-go
	cmechanic+ if
		pchar charchoice( " 'desmonta la maquina recreativa" )choice: traderarcade-mech
	then
;

// Road Punchers Machine

0 value rp-saguts
0 value rp-bryu

cyoa-choice: traderarcade-rp-done2
	rp-saguts 0 > rp-bryu 0 > and if
		clear-cyoa
		"Esta maquina recreativa se corta repentinamente!" text!
		"NO! WHAT DID YOU DOOOOOOOOOO?" bbold +crtext
		"El trabajador de la arcada esta menos feliz que nunca lo habia sido antes." +crtext badfx
	then 
;

: traderarcade-rp-done
	 // -10 add-food pchar .loot-to-trunk 
	 -10 trunk-food+ rp-saguts 0 > rp-bryu 0 > and if traderarcade-rp-done2 then 
;

cyoa-bridge: rp_recruit
	nearest .character@ choosechar cchar to recruitee ricon clear-cyoa
	($ cname .. " 'esta listo para probar su fuerza en la carretera de los punetazos." $) text!
	recruitee .strengthREV recruitee .fitnessREV
	cchar .name@ "BRYU" $= if "HADOOK! HADOOK! KADOOSHIN!" else "I-GER! I-GER! I-GER UPPERCUT!" then fbold +crtext recruit-yesno
	0.25 cchar .ai.wander_chance! 0 nearest .unseen!	
;

: rp_pop_share
	lt mission{ .smokepoof }
	0.01 lt .character@ .ai.wander_chance! 0 lt .character@ .ai.loot_chance! 1 lt .unseen!
	-30 lt .fade!
	90 lt .stun!
	180 lt .aim_angle! goodfx
	' rp_recruit cyoa!
;

: bryu_pop
	new-npc lt .character@ .bryuify rp_pop_share
;

: saguts_pop
	new-npc lt .character@ .sagutsify rp_pop_share
;

: traderarcade-bryu	bryu_pop ' rp-bryu ++ traderarcade-rp-done ;
: traderarcade-saguts saguts_pop ' rp-saguts ++ traderarcade-rp-done ;

cyoa: traderarcade-rp
	"Road Punchers 2: Los Nuevos Puncheros" cyoa-title!
	picon!
	($ "Este es una maquina recreativa antigua para el famoso juego de peleas clasico: " .. "ROAD PUNCHERS" bbold .. "
	This machine has been converted to run on food instead of quarters. It's 10 food to pick a character. For reasons unknown, it looks like almost all the characters are grayed out..." $) cyoa-text!
	+cr foodamt
		trunk-food 10 < if
			"No tienes la comida necesaria para jugar!" +crtext 
		then;
	choice( "Dejarlo para otro momento" )choice
	rp-saguts 1 < if
		choice( "Selecciona SAGUTS - 10 alimentos" )choice: traderarcade-saguts
	then
	rp-bryu 1 < if
		choice( "Selecciona BRYU - 10 alimentos" )choice: traderarcade-bryu
	then
;
	
// Fireproofing Arcade

cyoa-choice: traderarcade-fire-go
	"Fabricados en el Fogon" cyoa-title!
	($ "Al poner la comida y tocar el boton, la maquina recreativa " .. "EXPLODE DE INMEDIATO!" fbold .. " 'Real maduro!" $) cyoa-text!
	cchar statmod{ .fireproof? } not if
		($ cname .. " 'se quema completamente en una gran bola de fuego! Sin embargo, " .. che .. " 'sigue vivo y solo esta ligeramente irritado." .. cname .. "la piel se siente extranamente fresca." bbold $) +crtext
		cchar statmod{ .fireproof } sting-- bitefx
		choice( "AY! DOLOR!" )choice
	else
		($ cname .. " 'se envuelve en una bola de fuego! Por supuesto, esto no hace nada." .. cname .. " 'se siente bastante satisfecho con esto." bbold $) +crtext
		goodfx morale2+
	then
	-10 trunk-food+ clear-cyoa deleteme
;

cyoa: traderarcade-fire
	"Maquina arcade extrana" cyoa-title!
	picon!
	($ "Esta es una nueva maquina arcade. Hay letras gigantes en la pantalla que deletrean: " .. "EXPLOSIVOS DE FUEGO" rainbold .. "
	This machine has been converted to run on food, so the coin slot is enormous. There's only one button. Instead of any sort of gameplay, the machine displays a roaring fire behind the title..." $) cyoa-text!
	+cr foodamt
		trunk-food 10 < if
			"No tienes la comida necesaria para jugar!" +crtext 
		then;
	choice( "Dejarlo para otro momento" )choice
		pchar charchoice( " 'juega por 10 comida" )choice: traderarcade-fire-go
;

cyoa-choice: traderarcade-axe-go
	($ "Un hacha voladora se acerca cada vez mas, y luego " .. "PASA POR LA PANTALLA!" fbold .. " 'No hacen juegos asi anymore!" $) cyoa-text!
	cfitness+ cstrength+ or if
		($ cname .. "  es lo suficientemente fuerte para desviar el hacha. " .. cHe .. " 'se siente muy feliz de que el hacha haya sido manejada primero por el mango, no por la hoja." $) +crtext morale++ goodfx fitnessREV strengthREV
	else
		($ cname .. " 0.5" $) +crtext ouch-- bitefx
		alive? if morale-- then fitnessREV strengthREV
	then
	"La pantalla se descompone mientras el hacha cae al suelo." +crtext
	clear-cyoa
;

: traderarcade-axe-hard goldenaxe2 drop southofcyoa drop traderarcade-axe-go ;
: traderarcade-axe-normal goldenaxe1 drop southofcyoa drop traderarcade-axe-go ;

cyoa: traderarcade-axe
	"SELECCIONAR DIFICULTAD" cyoa-title!
	picon!
	($ "'Welcome to the 80's'  =  The machine is a bit dusty, but it's in good condition. " .. "HACHA*BRILLANTE" rainbold .. "la maquina recreativa parece funcionar con monedas de una cadena de arcades diferente. " .. pname .. " 'se da cuenta de esto y mira a trabajador de arcade, quien solo da un suspiro apatico y se desvia." $) cyoa-text!
	($ "Alguien ha colocado una moneda antes de que llegastez, dice " .. "UN CREDITO RESTANTE!" fbold .. " y, or = o " .. "SELECCIONE UN NIVEL DE DIFFICULTAD:" rbold $) +crtext
	choice( "Dejarlo para otro momento" )choice
	pchar charchoice( " 'juega en modo normal" )choice: traderarcade-axe-normal
	pchar charchoice( " 'juega en modo dificil" )choice: traderarcade-axe-hard
;


// NPC

cyoa: traderarcade
	"Trabajador de arcade" cyoa-title!
	"Estoy reviviendo los arcades! Van a ser muy populares ahora que la red ha sido destruida.		Sin reembolsos." bbold text!
;

}

roomgen{

: tradercade-box
	gasarcademachine
	' arcade-events events!
	5 lt .timer!
;

: traderarcade-shoot
	tradercade-box cyoa{ ' traderarcade-shoot cyoa! }
;

: traderarcade-rp
	tradercade-box cyoa{ ' traderarcade-rp cyoa! }
;

: traderarcade-fire
	tradercade-box cyoa{ ' traderarcade-fire cyoa! }
;

: traderarcade-axe
	tradercade-box cyoa{ ' traderarcade-axe cyoa! }
;

: .arcadify args( chara )
	"Arcader" <- chara .name!
;

: traderarcade-npc
	still-npc .arcadify cyoa{ ' traderarcade cyoa! } ;
	// regiondef{ ' trader-event lt .events! 1 lt .timer! }
}

map{ regiondef{

trade-camp-reset

: bldg tanchor!
	"arcade de comerciante" $picklocid addloc 
		prefab{
		BLINKY "EL ULTIMO " .. FLASHY .. "ARCADE" .. sign-text!
		0 0 0 sign-bg!
		0 1 0 sign-border!
		1 1 1 sign-fg!
		1 sign-glow!
		0 3 rnd 8 4 shop }
	
;
	
0 value gbx
0 value gby
0 value gbx2
0 value gby2

' plotpave >defer ft

: pt
	xyp.xy ft // Plot the current floor by default

	xyp.i char < = if xyp.xy to gby to gbx then;
	xyp.i char > = if gbx 1- gby xyp.xy swap 1+ swap gravellot then;
	xyp.i char ( = if xyp.xy to gby2 to gbx2 then;
	xyp.i char ) = if gbx2 1- gby2 xyp.xy swap 1+ swap gravellot then;
		
	xyp.i char P = if ' plotpave to ft xyp.xy ft then;
	
	xyp.i char x = if ' plotdirt to ft then;
	xyp.i char G = if ' plotgrass to ft xyp.xy ft then;
	xyp.i char $ = if xyp.xy grassedge then;
	xyp.i char { = if dirtstart then;
	xyp.i char } = if dirtend then;

	xyp.i char t = if pictable2 lt-here 8 rdrift then;		
	xyp.i char w = if pine lt-here drift then;
	xyp.i char V = if tradercarhere then;
	xyp.i char f = if campfirehere then;
		
	xyp.i char W = if trader-weapon-buyer then;
	xyp.i char T = if traderhere then;
	xyp.i char Z = if tnomey-spawn then;
	xyp.i char g = if trader-food-for-gas then;
	
	xyp.i char @ = if xyp.xy bldg then;
;

"
P........................
(........................
.........................
.........................
.........................
.........................
.........................
....W....@.........g..Z.)
.........................
.........................
.........................
.........................
.........................
.........................
........................."
constant maplayout

: plotmap
	0 -1 maplayout xyplot: pt
;

: site-setup
	1 no_time!
	17 19 rnd o'clock

	' plotdirt to ft

	30 %chance if 0 0.2 frnd weather! -1 2 frnd wind_force! else -1 1 frnd wind_force! then

	plotmap
	mission{ no-edge-spawns }

	// Put char and chars in middle of map
	25 %mv-up
	45 %chars-up
	
	map{ street-junk }
;

region: specialcamp-3
	w: maplayout layoutw
	h: maplayout layouth

	trade-mode

	post-script: site-setup

} }
