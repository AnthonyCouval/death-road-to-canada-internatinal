uses paul/region-layout.df

"events/inner/arcadeloc.df" $load

"
:map 1
:tags traderarcade  
:scriptA arcademachine -1 movey 
:scriptB cashcounter -1 movey 0.2 movex
:scriptC traderarcade-npc -0.5 movey 0.4 movex
:scriptD traderarcade-shoot -1 movey 
:scriptE traderarcade-rp -1 movey 
:scriptF clawmachine -1 movey
:scriptG traderarcade-fire -1 movey
:scriptH traderarcade-axe -1 movey
:size 14 9 
:off 8 0 
:tiles 
22222222222000
23333333332222
2AEADFGAHA3332
21111111111112
2111111111BC12
21111111111112
21111111111112
22222222222222
33333333333333
"
value TRADERARCADE
TRADERARCADE $parse-rooms

locdef{

location: traderarcade
		max-rooms: 1
		entry-tags: traderarcade
		pre-script: yall-theme
		script: yall-theme
		post-script: 
		
		room-choice: traderarcade
			room-weight: 10
			room-count: 1
			room-script: ndx 
			room-post-script:
			filter-only

}

cyoa{

// Shooting Arcade Machine

0 value traderarcade-shoot+

: traderarcade-amt traderarcade-shoot+ 2 * 2 + ;
: traderarcade-pay? trunk-food traderarcade-amt 1 - > ;
: traderarcade-pay traderarcade-amt -1 * trunk-food+ ;

cyoa-choice: traderarcade-mech
	($ "HEY! LASS DIE SPIELAUTOMATEN IN RUHE, DU NERD!" bbold $) text!
	"Der Spielhallenarbeiter ist nicht glucklich." +crtext
	($ cname .. "  zuckt zusammen." $) +crtext 
	mechanicREV badfx
;

cyoa-choice: traderarcade-shoot-go
	($ cname .. " ' setzt das Arcade Spiel fort. Der Bildschirm ist voller sich bewegender Formen. Es ist wirklich unmoglich zu sagen, was vor sich geht, und doch " .. che .. "  fuhlt sich vollig gefesselt.	Das Spiel endet in einem Blitz, doch es ist in " .. cname .. "'s Geist eingebrannt. Es gibt immer noch keinen Hinweis darauf wie das Spiel uberhaupt heit." $) cyoa-text!
		shootingREV shooting++ goodfx traderarcade-pay ' traderarcade-shoot+ ++
;

cyoa: traderarcade-shoot
	"Mystery Arcade Game" cyoa-title!
	picon!
	($ "Dieser Spielautomat hat seinen Munzschlitz durch einen groen Abfalleimer ersetzt auf dem steht " .. "HIER LEBENSMITTEL EINFUGEN" rbold .. " ' daruber.	Es ist nicht einmal klar, um welches Spiel es sich handeln soll, auf dem Bildschirm steht nur eine Meldung: " $) cyoa-text!
	($ "WEITER " fbold .. traderarcade-amt rainbold .. "  FUTTER" rainbold $) +text
	+cr foodamt
	chumany? not if
		($ pname .. " ' starrt verwirrt auf den Arcade Automaten. Tiere spielen meistens keine Videospiele, mit ein paar Ausnahmen. Zum Beispiel konnen Plattwurmer Walking Simulatoren spielen, obwohl sie das erhabene Genie der Erzahlung nicht verstehen konnen." $) +crtext
	then;
		traderarcade-pay? not if
			"'Du kannst dir das nicht leisten." +crtext 
		then;
	choice( "Lass es erstmal so" )choice
	pchar charchoice( "  spielt fur " .. traderarcade-amt .. "  essen" )choice: traderarcade-shoot-go
	cmechanic+ if
		pchar charchoice( "  zerlegt den Arcade Automaten" )choice: traderarcade-mech
	then
;

// Road Punchers Machine

0 value rp-saguts
0 value rp-bryu

cyoa-choice: traderarcade-rp-done2
	rp-saguts 0 > rp-bryu 0 > and if
		clear-cyoa
		"Dieser Arcade Automat hat plotzlich einen Kurzschluss!" text!
		"NO! WHAT DID YOU DOOOOOOOOOO?" bbold +crtext
		"Der Arcade Mitarbeiter ist noch unglucklicher als bisher fur moglich gehalten." +crtext badfx
	then 
;

: traderarcade-rp-done
	 // -10 add-food pchar .loot-to-trunk 
	 -10 trunk-food+ rp-saguts 0 > rp-bryu 0 > and if traderarcade-rp-done2 then 
;

cyoa-bridge: rp_recruit
	nearest .character@ choosechar cchar to recruitee ricon clear-cyoa
	($ cname .. "  ist bereit seine Starke auf dem Weg des Schlagens zu testen." $) text!
	recruitee .strengthREV recruitee .fitnessREV
	cchar .name@ "BRYU" $= if "'HADOOK! HADOOK! KADOOSHIN'!" else "I GER! I GER! I GER UPPERCUT!" then fbold +crtext recruit-yesno
	0.25 cchar .ai.wander_chance! 0 nearest .unseen!	
;

: rp_pop_share
	lt mission{ .smokepoof }
	0.01 lt .character@ .ai.wander_chance! 0 lt .character@ .ai.loot_chance! 1 lt .unseen!
	-30 lt .fade!
	90 lt .stun!
	180 lt .aim_angle! goodfx
	' rp_recruit cyoa!
;

: bryu_pop
	new-npc lt .character@ .bryuify rp_pop_share
;

: saguts_pop
	new-npc lt .character@ .sagutsify rp_pop_share
;

: traderarcade-bryu	bryu_pop ' rp-bryu ++ traderarcade-rp-done ;
: traderarcade-saguts saguts_pop ' rp-saguts ++ traderarcade-rp-done ;

cyoa: traderarcade-rp
	"Road Punchers 2: The New Punchers" cyoa-title!
	picon!
	($ "Dies ist ein alter Arcade Automat fur das beruhmte klassische Kampfspiel: " .. "ROAD PUNCHERS" bbold .. "
	This machine has been converted to run on food instead of quarters. It's 10 food to pick a character. For reasons unknown, it looks like almost all the characters are grayed out..." $) cyoa-text!
	+cr foodamt
		trunk-food 10 < if
			"'Du hast nicht genug Futter um zu spielen!" +crtext 
		then;
	choice( "Lass es erstmal so" )choice
	rp-saguts 1 < if
		choice( "Wahle SAGUTS   10 Futter" )choice: traderarcade-saguts
	then
	rp-bryu 1 < if
		choice( "10 food" )choice: traderarcade-bryu
	then
;
	
// Fireproofing Arcade

cyoa-choice: traderarcade-fire-go
	"Geschmiedet im Feuer" cyoa-title!
	($ "Beim Einlegen des Futters und Beruhren des Knopfes, die Arcade Maschine " .. "EXPLODIERT SOFORT!" fbold .. "  Wirklich reif!" $) cyoa-text!
	cchar statmod{ .fireproof? } not if
		($ cname .. "  wird in einem groen Feuerball verbrannt! Jedoch " .. che .. "  lebt und ist nur leicht irritiert.		" .. cname .. "' Haut fuhlt sich seltsam kuhl an." bbold $) +crtext
		cchar statmod{ .fireproof } sting-- bitefx
		choice( "AU! VERDAMMT NOCHMAL!" )choice
	else
		($ cname .. " ' wird von einem Feuerball verschlungen! Das macht naturlich nichts.		" .. cname .. "  fuhlt sich ziemlich selbstgefallig daruber." bbold $) +crtext
		goodfx morale2+
	then
	-10 trunk-food+ clear-cyoa deleteme
;

cyoa: traderarcade-fire
	"Seltsame Arcade Maschine" cyoa-title!
	picon!
	($ "Dies ist eine neu aussehende Arcade Maschine. Auf dem Bildschirm stehen riesige Buchstaben die Folgendes buchstabieren: " .. "FEUER EXPLOSIONEN" rainbold .. "
	This machine has been converted to run on food, so the coin slot is enormous. There's only one button. Instead of any sort of gameplay, the machine displays a roaring fire behind the title..." $) cyoa-text!
	+cr foodamt
		trunk-food 10 < if
			"'Du hast nicht genug Futter um zu spielen!" +crtext 
		then;
	choice( "Lass es erstmal so" )choice
		pchar charchoice( "  spielt fur 10 Essen" )choice: traderarcade-fire-go
;

cyoa-choice: traderarcade-axe-go
	($ "Eine fliegende Axt dreht sich immer naher und naher und dann " .. "FLIEGT DURCH DEN BILDSCHIRM!" fbold .. " ' Solche Spiele werden heutzutage nicht mehr gemacht!" $) cyoa-text!
	cfitness+ cstrength+ or if
		($ cname .. "  ist korperlich fit genug um die Axt abzuwehren " .. cHe .. "  ist sehr froh, dass die Axt mit dem Griff voran und nicht mit der Klinge voran gehalten wurde." $) +crtext morale++ goodfx fitnessREV strengthREV
	else
		($ cname .. " ' bekommt die Axt direkt ins Gesicht, Griff voran! Der Mitarbeiter der Spielhalle freut sich daruber, da es weniger aufzuraumen gibt, als es das andere Ende erfordert hatte." $) +crtext ouch-- bitefx
		alive? if morale-- then fitnessREV strengthREV
	then
	"Der Bildschirm flackert als die Axt auf den Boden fallt." +crtext
	clear-cyoa
;

: traderarcade-axe-hard goldenaxe2 drop southofcyoa drop traderarcade-axe-go ;
: traderarcade-axe-normal goldenaxe1 drop southofcyoa drop traderarcade-axe-go ;

cyoa: traderarcade-axe
	"SCHWIERIGKEITSGRAD AUSWAHLEN" cyoa-title!
	picon!
	($ "'Dieser Automat vermittelt ein 80er Jahre Feeling. Auf dem Bildschirm erscheinen goldene Buchstaben die Folgendes ergeben: " .. "SHINY*AXE" rainbold .. "der Spielautomat scheint mit Jetons einer anderen Spielhallen Kette zu funktionieren. " .. pname .. "  bemerkt dies und dreht sich zu dem Mitarbeiter der Spielhalle um, der nur achselzuckend den Blick abwendet." $) cyoa-text!
	($ "Jemand muss einen Jeton eingeworfen haben, bevor du hierher gekommen bist, auf dem Bildschirm steht " .. "EIN GUTHABEN VERBLEIBEND!" fbold .. "  und " .. "SCHWIERIGKEITSGRAD AUSWAHLEN:" rbold $) +crtext
	choice( "Lass es erstmal so" )choice
	pchar charchoice( "  spielt im NORMAL Modus" )choice: traderarcade-axe-normal
	pchar charchoice( "  spielt auf HARD Modus" )choice: traderarcade-axe-hard
;


// NPC

cyoa: traderarcade
	"Arbeiter der Arcade" cyoa-title!
	"'Ich bringe Arcades zuruck! Sie werden sehr beliebt sein jetzt dass das Internet zerstort wurde.	Keine Wiedergangigkeiten." bbold text!
;

}

roomgen{

: tradercade-box
	gasarcademachine
	' arcade-events events!
	5 lt .timer!
;

: traderarcade-shoot
	tradercade-box cyoa{ ' traderarcade-shoot cyoa! }
;

: traderarcade-rp
	tradercade-box cyoa{ ' traderarcade-rp cyoa! }
;

: traderarcade-fire
	tradercade-box cyoa{ ' traderarcade-fire cyoa! }
;

: traderarcade-axe
	tradercade-box cyoa{ ' traderarcade-axe cyoa! }
;

: .arcadify args( chara )
	"Arcader" <- chara .name!
;

: traderarcade-npc
	still-npc .arcadify cyoa{ ' traderarcade cyoa! } ;
	// regiondef{ ' trader-event lt .events! 1 lt .timer! }
}

map{ regiondef{

trade-camp-reset

: bldg tanchor!
	"handlerarcade" $picklocid addloc 
		prefab{
		BLINKY "LETZTES " .. FLASHY .. "ARCADE" .. sign-text!
		0 0 0 sign-bg!
		0 1 0 sign-border!
		1 1 1 sign-fg!
		1 sign-glow!
		0 3 rnd 8 4 shop }
	
;
	
0 value gbx
0 value gby
0 value gbx2
0 value gby2

' plotpave >defer ft

: pt
	xyp.xy ft // Plot the current floor by default

	xyp.i char < = if xyp.xy to gby to gbx then;
	xyp.i char > = if gbx 1- gby xyp.xy swap 1+ swap gravellot then;
	xyp.i char ( = if xyp.xy to gby2 to gbx2 then;
	xyp.i char ) = if gbx2 1- gby2 xyp.xy swap 1+ swap gravellot then;
		
	xyp.i char P = if ' plotpave to ft xyp.xy ft then;
	
	xyp.i char x = if ' plotdirt to ft then;
	xyp.i char G = if ' plotgrass to ft xyp.xy ft then;
	xyp.i char $ = if xyp.xy grassedge then;
	xyp.i char { = if dirtstart then;
	xyp.i char } = if dirtend then;

	xyp.i char t = if pictable2 lt-here 8 rdrift then;		
	xyp.i char w = if pine lt-here drift then;
	xyp.i char V = if tradercarhere then;
	xyp.i char f = if campfirehere then;
		
	xyp.i char W = if trader-weapon-buyer then;
	xyp.i char T = if traderhere then;
	xyp.i char Z = if tnomey-spawn then;
	xyp.i char g = if trader-food-for-gas then;
	
	xyp.i char @ = if xyp.xy bldg then;
;

"
P........................
(........................
.........................
.........................
.........................
.........................
.........................
....W....@.........g..Z.)
.........................
.........................
.........................
.........................
.........................
.........................
........................."
constant maplayout

: plotmap
	0 -1 maplayout xyplot: pt
;

: site-setup
	1 no_time!
	17 19 rnd o'clock

	' plotdirt to ft

	30 %chance if 0 0.2 frnd weather! -1 2 frnd wind_force! else -1 1 frnd wind_force! then

	plotmap
	mission{ no-edge-spawns }

	// Put char and chars in middle of map
	25 %mv-up
	45 %chars-up
	
	map{ street-junk }
;

region: specialcamp-3
	w: maplayout layoutw
	h: maplayout layouth

	trade-mode

	post-script: site-setup

} }
