uses paul/region-layout.df

"../deathforth/rooms/duodenum.txt" $load-rooms

locdef{

: swolegym-lights
	20000 70 50 ticklight
	20000 130 60 ticklight
	20000 200 50 ticklight
;

location: tradergym
		max-rooms: 1
		entry-tags: traderswole-entry
		pre-script: yall-theme
		script: yall-theme
		post-script: 
		
		room-choice: traderswole-entry
			room-weight: 10
			room-count: 1
			room-script: ndx 
			room-post-script: swolegym-lights
			filter-only

}

cyoa{

// Stat Trainers

0 value tradergym-strength+

: swolegym-train-amt numhums 2 * tradergym-strength+ 1 + * 1 + ; 
: swolegym-train-pay? trunk-food swolegym-train-amt 1 - > notsolo notsolohuman and and ;
: swolegym-train-pay swolegym-train-amt -1 * trunk-food+ ;

: swolegym-solo-amt tradergym-strength+ 2 * 3 + ;
: swolegym-solo-pay? trunk-food swolegym-solo-amt 1 - > ;
: swolegym-solo-pay swolegym-solo-amt -1 * trunk-food+ ;

cyoa-choice: tradergym-strength-train
	cchar .strength@ 6 < if
		($ cname .. " il se met tous en flamme grace a son regime d'entrainement de force !" $) goodfx
	else
		($ cname .. " a atteint les limites de ce que la formation peut faire pour " .. chim .. "!" $) badfx
	then cyoa-text! 
	swolegym-solo-pay strengthREV strength++ ' tradergym-strength+ ++
;

cyoa-choice: tradergym-strength-group
	($ "Toute le groupe se renforce par l'entrainement de force !" $) cyoa-text! goodfx
	swolegym-train-pay someicon
	regiondef{ ' trade-strength-group! foreach-human-char } numhums ' tradergym-strength+ +!
;

cyoa: tradergym-strength-give
	solohuman if
		choosehuman tradergym-strength-train
	then;
	"Celui qui veut developper sa force a un niveau eleve doit effectuer cette intense routine de travail." cyoa-text!
	' tradergym-strength-train cyoa-human-choice
;

cyoa: tradergym-strength
	($ "FLATULATIONS.* " rbold .. "BRAVO !" rainbold .. " FORT, PUISSANT" fbold $) cyoa-title!
	"Bienvenue sur la montagne bulleteuse !. . 	avec les methodes brevetees de montagne bulleteuse, je peux vous entrainer jusqu'a n'importe quel niveau de force voulu, vitement !. . 	tant que vous avez de la nourriture, nous pouvons continuer a entrainer !" rbold text! +cr foodamt
		swolegym-solo-pay? not if
			"Vous ne pouvez plus vous permettre d'autres formations." +crtext 
		then;
		choice( "Laissez-le pour le moment" )choice
		swolegym-solo-pay? if
			choice( "Donner " .. swolegym-solo-amt .. " nourriture pour une formation unique" )choice: tradergym-strength-give
		then
		swolegym-train-pay? if
			choice( "Donner " .. swolegym-train-amt .. " vous devez vous entrainer et mettre du muscle !" )choice: tradergym-strength-group
		then
		
;

0 value tradergym-fitness+

: swolefit-train-amt numhums 2 * tradergym-fitness+ 1 + * 1 + ; 
: swolefit-train-pay? trunk-food swolefit-train-amt 1 - > notsolo notsolohuman and and ;
: swolefit-train-pay swolefit-train-amt -1 * trunk-food+ ;

: swolefit-solo-amt tradergym-fitness+ 2 * 3 + ;
: swolefit-solo-pay? trunk-food swolefit-solo-amt 1 - > ;
: swolefit-solo-pay swolefit-solo-amt -1 * trunk-food+ ;

cyoa-choice: tradergym-fitness-train
	cchar .fitness@ 6 < if
		($ cname .. " se met a s'exciter de son regime d'entrainement sportif !" $) goodfx
	else
		($ cname .. " a atteint les limites de ce que la formation peut faire pour " .. chim .. "!" $) badfx
	then cyoa-text! 
	swolefit-solo-pay fitnessREV fitness++ ' tradergym-fitness+ ++
;

cyoa-choice: tradergym-fitness-group
	($ "Toute le groupe recoit une formation de fitness !" $) cyoa-text! goodfx
	swolefit-train-pay someicon
	regiondef{ ' trade-fitness-group! foreach-human-char } numhums ' tradergym-fitness+ +!
;

cyoa: tradergym-fitness-give
	solohuman if
		choosehuman tradergym-fitness-train
	then;
	"Celui qui desire un entrainement intense pour ameliorer sa condition physique." cyoa-text!
	' tradergym-fitness-train cyoa-human-choice
;

cyoa: tradergym-fitness
	($ "FLATULATIONS.* " rbold .. "TU RECEVRAIS EGALEMENT CELA" rainbold .. " ADAPTEZ" fbold $) cyoa-title!
	"Bienvenue sur montagne rasee !. . 	ici a montagne rasee, nous croyons que l'entrainement cardio est tres important !. . 	tant qu'on a la nourriture, nous pouvons continuer a s'entrainer !" rbold text! +cr foodamt
		swolefit-solo-pay? not if
			"Vous ne pouvez plus vous permettre d'autres formations." +crtext 
		then;
		choice( "Laissez-le pour le moment" )choice
		swolefit-solo-pay? if
			choice( "Donner " .. swolefit-solo-amt .. " nourriture pour une formation unique" )choice: tradergym-fitness-give
		then
		swolefit-train-pay? if
			choice( "Donner " .. swolefit-train-amt .. " vous devez vous entrainer et mettre du muscle !" )choice: tradergym-fitness-group
		then
		
;

// Boxing Training

cyoa-choice: tradergym-boxing-train
	cchar .weapon_default@ WEAPON_BOXING = if
		($ cname .. " j'etais deja capable de lancer un coup de poing !" .. "Pratiquons notre pas, alors !" bbold $) text!
		dexterity++
	else
		($ cname .. " obtiens une formation d'boxe avec un expert !" .. cname .. ": appris le coup de boxe !" rbold $) text!
		WEAPON_BOXING cchar .weapon_default!
	then goodfx clear-cyoa
	-20 trunk-food+ vitality++ strength++ strengthREV fitness++ fitnessREV
;

cyoa: tradergym-boxing-give
	solohuman if
		choosehuman tradergym-boxing-train
	then;
	"Quelqu'un qui veut atteindre un excellence remarquable en boxe et qui est pret a se consacrer entierement a l'entrainement." cyoa-text!
	' tradergym-boxing-train cyoa-human-choice
;

cyoa: tradergym-boxing
	($ "ENTRAINEMENT SPECIEL DE BOXE" fbold $) cyoa-title!
	"Offre speciale aujourd'hui, valable pour une personne !. .  je peux vous enseigner une lecon de boxe intensive ! vous apprendrez a frapper et je vous offrirai egalement une forte dose d'exercice pour renforcer votre corps, accroitre votre energie et vous rendre plus resistant." bbold text! +cr foodamt
		choice( "Laissez-le pour le moment" )choice
		trunk-food 19 > if
			choice( "Voici vingt aliments ideaux pour l'entrainement de boxe :" )choice: tradergym-boxing-give
		then
;


0 value tradergym-shady-1-buy
0 value tradergym-shady-2-buy
0 value tradergym-shady-3-buy

cyoa-choice: tradergym-shady-1
	iicon ($ pname .. " achete quelque chose " .. "COUPS DE POING" bbold .. "!
	" .. "Rien ne bat une bonne paire de knuckles." pbold $) text!
	goodfx 1 WEAPON_KNUCKS trunk.weapon+ -3 trunk-food+ ' tradergym-shady-1-buy ++
;

: .shadypump args( chara )
	<- chara .specialtype@ 0 > if
		<- chara .specialtype@ 25 = if
			<- chara .zombiewrestler
			1.3 <- chara .scale.body.x!
		else
			<- chara .specialtype@ <- chara .specialhead!
			0 <- chara .specialtype!
			1 <- chara .headoff.y!
		then
	else
		4 <- chara .headoff.y!
	then
	25 <- chara .specialbody!
	100 STAT_STRENGTH <- chara .bonus! 6 <- chara .strength!
	"maintenant vraiment pompe" <- chara .job!
	<- chara .zombielifter
	<- chara .specialhead@ 34 <> if <- chara .nocanshoot else "Offrez-lui un coup de main" <- chara .name! then
	statmod{ MOD_TLBB <- chara .setmod } <- chara .swapspecial <- chara .atkspecial
;

cyoa-choice: tradergym-shady-2-go
	iicon ($ cname .. " apprend a connaitre " .. "MISE A NIVEAU DE LA MAIN" bbold .. "!" $) text!
	cchar .specialtype@ 25 = if	
		($ "WHAT HAVE YOU DONE?
		WHAT HAVE YOU DOOOOOOOONE????
		" fbold .. cname .. " gagne un peu plus de masse musculaire !" rbold .. cname .. " maintenant, vous pouvez recuperer les zombies meme avant qu'ils tombent a terre !" rbold $) +crtext
	else
		($ cHis .. " la force est. " .. "RAISED TO IMPOSSIBLE LEVELS!!!" fbold $) +crtext
		"Laissez-le etre" pbold +crtext 
	then goodfx
	-20 trunk-food+ ' tradergym-shady-2-buy ++
		cchar .shadypump
;

cyoa: tradergym-shady-2
	solohuman if
		choosehuman tradergym-shady-2-go
	then;
	"Quelqu'un devrait apprendre a utiliser la pompe interdite ?" cyoa-text!
	' tradergym-shady-2-go cyoa-human-choice
;

cyoa-choice: tradergym-shady-3-go
	iicon ($ cname .. " apprend a connaitre " .. "LE SORCIER" bbold .. "!
	" .. "Connaissance simplement de cela declenche une metamorphose. " .. cname .. "'s body..." $) text!
	"Refusion de remboursement." pbold +crtext goodfx
	-20 trunk-food+ ' tradergym-shady-3-buy ++
		cchar .specialbody@ 25 = cchar .specialtype@ 25 = or if -6 cchar .headoff.y! then
		1.6 cchar .scale.body.y!
		0.6 cchar .scale.body.x!
		dexterity++
;

cyoa: tradergym-shady-3
	solohuman if
		choosehuman tradergym-shady-3-go
	then;
	"Quelqu'un devrait apprendre la diete parfaite s'il souhaite ameliorer sa sante et atteindre son poids ideal. cependant, il est important de noter que chaque personne est unique et qu'il n'existe pas une" cyoa-text!
	' tradergym-shady-3-go cyoa-human-choice
;

cyoa: tradergym-shady
	"Dresseur ombrageux" cyoa-title!
	"Those other guys are a bunch of neeeerds.
	I got the real training!" pbold text!
	+cr foodamt
		trunk-food 3 < if
			"Le dresseur ombrageux sourit mechamment a toi." +crtext 
		then;
		choice( "Laissez-le pour le moment" )choice
		trunk-food 2 > tradergym-shady-1-buy 3 < and if
			choice( "Acheter des brass knucks - 3 aliments" )choice: tradergym-shady-1
		then
		trunk-food 19 > tradergym-shady-2-buy 1 < and if
			choice( "Apprendre la pompe interdite - 20 aliments" )choice: tradergym-shady-2
		then
		trunk-food 19 > tradergym-shady-3-buy 1 < and if
			choice( "Apprendre parfaitement diete - 20 aliments" )choice: tradergym-shady-3
		then
;

}

roomgen{

: tradergym-npc still-npc regiondef{ ' trader-event lt .events! 1 lt .timer! } ;

: .tradergym-fitness args( chara ) 
	3 <- chara .bodytype!
	19 <- chara .hairtype!
	0 <- chara .hattype!
	13 <- chara .legstype!
	1 <- chara .torsotype! ;
: tradergym-fitness
	tradergym-npc .tradergym-fitness cyoa{ ' tradergym-fitness cyoa! } ;
: .tradergym-strength args( chara ) 
	12 <- chara .haircolour!
	9 <- chara .torsotype!
	0 <- chara .hattype!
	10 <- chara .legstype! 
	2 <- chara .bodytype! ;
: tradergym-strength
	tradergym-npc .tradergym-strength cyoa{ ' tradergym-strength cyoa! } ;
: tradergym-boxing
	tradergym-npc .tradergym-strength cyoa{ ' tradergym-boxing cyoa! } 
	WEAPON_GLOVE lt .character@ .weapona! 
	1 lt .character@ .weapon_nodropa! ;
: tradergym-shady
	still-npc .tradergym-fitness cyoa{ ' tradergym-shady cyoa! } 
	0 lt .character@ .bodytype! ;

}

map{ regiondef{

trade-camp-reset

: bldg tanchor!
	"le tradergym est une plateforme de simulation de commerce en ligne." $picklocid addloc 
		prefab{
		GREEN "MONTAGNE GONFLEE " .. RED .. BLINKY .. "FLATULATIONS.* " .. RAINBOW .. "VOUS RECEVEZ " .. FLASHY .. "EFFILE," .. sign-text!
		0 0 0 sign-bg!
		0 1 0 sign-border!
		1 1 1 sign-fg!
		1 sign-glow!
		0 3 rnd 15 4 shop }
	
;
	
0 value gbx
0 value gby
0 value gbx2
0 value gby2

' plotpave >defer ft

: pt
	xyp.xy ft // Plot the current floor by default

	xyp.i char < = if xyp.xy to gby to gbx then;
	xyp.i char > = if gbx 1- gby xyp.xy swap 1+ swap gravellot then;
	xyp.i char ( = if xyp.xy to gby2 to gbx2 then;
	xyp.i char ) = if gbx2 1- gby2 xyp.xy swap 1+ swap gravellot then;
		
	xyp.i char P = if ' plotpave to ft xyp.xy ft then;
	
	xyp.i char x = if ' plotdirt to ft then;
	xyp.i char G = if ' plotgrass to ft xyp.xy ft then;
	xyp.i char $ = if xyp.xy grassedge then;
	xyp.i char { = if dirtstart then;
	xyp.i char } = if dirtend then;

	xyp.i char t = if pictable2 lt-here 8 rdrift then;		
	xyp.i char w = if pine lt-here drift then;
	xyp.i char V = if tradercarhere then;
	xyp.i char f = if campfirehere then;
		
	xyp.i char W = if trader-weapon-buyer then;
	xyp.i char T = if traderhere then;
	xyp.i char Z = if tnomey-spawn then;
	
	xyp.i char @ = if xyp.xy bldg then;
;

"
P........................
(........................
................Z..W.....
.........................
.........................
...................f.....
.........................
@.......................
........................)
.........................
.........................
.........................
.........................
.........................
.........................
........................."
constant maplayout

: plotmap
	0 -1 maplayout xyplot: pt
;

: site-setup
	1 no_time!
	19 24 rnd o'clock

	' plotdirt to ft

	30 %chance if 0 0.2 frnd weather! -1 2 frnd wind_force! else -1 1 frnd wind_force! then

	plotmap
	mission{ no-edge-spawns }

	// Put char and chars in middle of map
	25 %mv-up
	45 %chars-up
	
	map{ street-junk }
;

region: specialcamp-3
	w: maplayout layoutw
	h: maplayout layouth

	trade-mode

	post-script: site-setup

} }
