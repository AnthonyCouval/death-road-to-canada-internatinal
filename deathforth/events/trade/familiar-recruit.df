0 stack var familiar-stack

: .applyperk args( chara )
	0 6 rnd <- chara .wits! 0 6 rnd <- chara .attitude!
	0 6 rnd <- chara .composure! 0 6 rnd <- chara .loyalty!
	<- chara .perk@ dup "A APLICAR VANTAGEM: " type print perk-find dup if <- chara swap execute then
;

: .applytrait args( chara )
	<- chara .trait@ dup "A APLICAR TRACO: " type print trait-find dup if <- chara swap execute then
;

: draw-familiar
	familiar-stack depths for
		pops #savechar-clone dup if
			nip #character
			dup .applyperk dup .applytrait
		then;
		drop
	next
	drop 0
;

cyoa{ road{

: fam-text
	0 stack
		($ rHe .. " 'nao viu " .. thegroup .. " ainda, e esta muito ocupado a apanhar " .. rhis .. " nariz." $) shove
		($ rHe .. " esta a dormir numa mesa de piquenique, bem ao ar livre." $) shove
		($ rHe .. "  foi pego tentando abrir uma porta com a indicacao de EMPURRAR." $) shove
		($ rHe .. " ' esta cantarolando uma musiquinha e nao percebeu " .. thegroup .. "  ainda." $) shove
		($ rHe .. "  esta sendo expulso por " .. rhis .. "  ex grupo. Eles parecem bem irritados. " .. rname .. " de ombros" $) shove
		($ rHe .. "  estava dormindo em uma casa abandonada. " .. rHe .. "  esta um pouco irritado por ter sido acordado." $) shove
		($ rHe .. "  esta sentado em um parque, lendo um livro." $) shove
		($ rHe .. "  estava fazendo muito barulho, jogando em um console portatil no volume maximo." $) shove
		($ rHe .. " ' esta comendo uma barra de chocolate. Essas coisas ainda nao estragaram." $) shove
		($ rHe .. "  se alonga. Entao " .. rhe .. " ' se alonga mais um pouco. E uma rotina de alongamento elaborada." $) shove
		($ rHe .. "  cutuca a sujeira com um graveto. Talvez " .. rhe .. "  esteja desenhando planos, ou talvez so cutucando a sujeira com um graveto." $) shove
		($ rHe .. "  esta olhando um mapa, com uma expressao de total confusao." $) shove
		($ rHe .. "  esta gritando com alguns sobreviventes, porque eles zombaram de " .. rhis .. "  cabelo." $) shove
		($ rHe .. "  esta chutando um carro em frustracao. O carro esta emitindo nuvens de fumaca." $) shove
		($ rHe .. "  esta lutando contra um unico zumbi, entao de repente tropeca e cai em um erro estranho. " .. rHe .. "  fica muito envergonhado quando " .. rhe .. "  percebe " .. thegroup .. "." $) shove
		// ($ rHe .. " " $) shove
	shuffles pops nip
;

: familiar-carnut-yes
	perkdef{
		carnut-picker to starting-car
		starting-car get-car 
	}
;

cyoa: familiar-carnut-event
	"Passeio Doce" cyoa-title! ricon
		($ rname .. "  disse que " .. rhe .. "  tinha " .. rhis .. " ' proprio carro escondido nas proximidades, e que e um " .. "''passeio muito doce'" pbold .. "		Voce gostaria de mudar para " .. rname .. "''s carro?" $) cyoa-text!
		choice( "Mantenha o carro atual" )choice
		choice( "Mude para um carro novo" )choice: familiar-carnut-yes
		
;

: familiar-recruit-check
	perkdef{
		recruitee carnut? if
			' familiar-carnut-event stack-road-action
		then 
	}
;

cyoa-choice: recruit-familiarreplace
	ricon
	($ cname .. "  e expulso do grupo para abrir espaco para " .. rname .. "." $) cyoa-text!
	decruit-bad-silent-takeweapons 0.5 600 tone
	recruited
	familiar-recruit-check
;

: recruit-familiarreplace?
	' recruit-familiarreplace cyoa-team-choice
	choice( "Deixe " .. rname .. "  para tras" )choice
;

cyoa: recruit-familiaryes
	team-full? if
		($ "O grupo esta cheio. Quem voce gostaria de substituir para abrir espaco para " .. rname .. "?" $) cyoa-text!
			recruit-familiarreplace?
	then;
	ricon
	($ Thegroup .. "  aceita " .. rname .. "  para o time!" $) cyoa-text! 2 300 tone
	recruited
	familiar-recruit-check
;

defer use-recruit-deck

cyoa: famevent
	"Rostos familiares" cyoa-title!

	draw-familiar dup not if drop "NAO HA MAIS PESSOAS!" text! use-recruit-deck then;

	to recruitee ricon

	($ "'Uau, e " .. rname .. "'! E bom ver um rosto familiar! " .. fam-text $) text! 
		($ "TRACO: " pbold .. recruitee .trait@ $) +crtext 
		($ "   VANTAGEM: " pbold .. recruitee .perk@ $) +text 
			choice( "Recrutar " .. rname .. "  para o time" )choice: recruit-familiaryes
			choice( "Deixe " .. rname .. "  para tras" )choice
;

} }


