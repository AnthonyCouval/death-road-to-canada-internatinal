0 stack var familiar-stack

: .applyperk args( chara )
	0 6 rnd <- chara .wits! 0 6 rnd <- chara .attitude!
	0 6 rnd <- chara .composure! 0 6 rnd <- chara .loyalty!
	<- chara .perk@ dup "'PERK ANWENDEN: " type print perk-find dup if <- chara swap execute then
;

: .applytrait args( chara )
	<- chara .trait@ dup "'TRAIT ANWENDEN: " type print trait-find dup if <- chara swap execute then
;

: draw-familiar
	familiar-stack depths for
		pops #savechar-clone dup if
			nip #character
			dup .applyperk dup .applytrait
		then;
		drop
	next
	drop 0
;

cyoa{ road{

: fam-text
	0 stack
		($ rHe .. " 'hat " .. thegroup .. " 'noch nicht gesehen und ist sehr beschaftigt mit dem " .. rhis .. " 'Ausputzen der Nase." $) shove
		($ rHe .. " 'schlaft auf einem Picknicktisch, mitten im Freien." $) shove
		($ rHe .. " es wurde versucht, eine Tur zu offnen, die mit ZIEHEN beschriftet war." $) shove
		($ rHe .. "  summt ein kleines Liedchen und hat nicht bemerkt " .. thegroup .. " noch nicht" $) shove
		($ rHe .. " wird hinausgeworfen von " .. rhis .. " 'ehemals eine Gruppe. Sie scheinen recht wutend aufeinander zu sein.', " .. rname .. " 'zuckt mit den Schultern." $) shove
		($ rHe .. " 'in einem verlassenen Haus schlief.', " .. rHe .. " 'leicht irritiert ist, wegen des Aufwachsen geworden zu sein.'," $) shove
		($ rHe .. " 'sitzt in einem Park und liest ein Buch.'," $) shove
		($ rHe .. " 'machte viel Larm, spielte mit einem handgehaltenen Spielkonsolen voll aus.'," $) shove
		($ rHe .. " 'ist essend einen Schokoladen-Bonbon. Solche Dinge sind noch nicht vergangen.'," $) shove
		($ rHe .. " 'streckt sich. Danach', " .. rhe .. " 'streckt sich noch mehr. Das ist eine ausgedehnte Streckroutine.'," $) shove
		($ rHe .. " 'poket den Boden mit einem Stick. Vielleicht', " .. rhe .. " 'zeichnet Plane, vielleicht nur den Boden mit einem Stick poket.'," $) shove
		($ rHe .. " 'starrt auf eine Karte und hat ein Ausdruck totaler Verwirrung.'," $) shove
		($ rHe .. " 'jodelt bei einigen Uberlebenden, weil sie an', " .. rhis .. " " $) shove
		($ rHe .. "  tritt frustriert gegen ein Auto. Das Auto stoÃŸt Rauchwolken aus." $) shove
		($ rHe .. "  kampft gegen einen einzelnen Zombie, dann plotzlich stolpert und fallt in einem ungeschickten Fehler. " .. rHe .. " wird wirklich verlegen, wenn " .. rhe .. " hinweise " .. thegroup .. "." $) shove
		// ($ rHe .. " " $) shove
	shuffles pops nip
;

: familiar-carnut-yes
	perkdef{
		carnut-picker to starting-car
		starting-car get-car 
	}
;

cyoa: familiar-carnut-event
	"SuÃŸe Fahrt" cyoa-title! ricon
		($ rname .. " ' sagte, dass " .. rhe .. " ' hatte " .. rhis .. " ' ein eigenes Auto in der Nahe, und dass es " .. "'ein ziemlich cooles Gefahrt" pbold .. "'Mochtest du zu " .. rname .. "'ihrem Auto wechseln?" $) cyoa-text!
		choice( "'Behalte aktuelles Auto" )choice
		choice( "'Zu neuen Auto wechseln" )choice: familiar-carnut-yes
		
;

: familiar-recruit-check
	perkdef{
		recruitee carnut? if
			' familiar-carnut-event stack-road-action
		then 
	}
;

cyoa-choice: recruit-familiarreplace
	ricon
	($ cname .. " 'wird aus der Gruppe geworfen, um Platz fur zu machen " .. rname .. "." $) cyoa-text!
	decruit-bad-silent-takeweapons 0.5 600 tone
	recruited
	familiar-recruit-check
;

: recruit-familiarreplace?
	' recruit-familiarreplace cyoa-team-choice
	choice( "'Verlasse " .. rname .. " 'zuruck" )choice
;

cyoa: recruit-familiaryes
	team-full? if
		($ "'Die Gruppe ist voll. Wen mochtest du dafur ersetzen, um Platz fur zu machen? " .. rname .. "?" $) cyoa-text!
			recruit-familiarreplace?
	then;
	ricon
	($ Thegroup .. " 'akzeptiert " .. rname .. " 'fur das Team!" $) cyoa-text! 2 300 tone
	recruited
	familiar-recruit-check
;

defer use-recruit-deck

cyoa: famevent
	"'Bekannte Gesichter" cyoa-title!

	draw-familiar dup not if drop "['KEINE MEHR PEOPLE!']," text! use-recruit-deck then;

	to recruitee ricon

	($ "'Wow, das ist " .. rname .. "'! Schon, eine bekannte Person zu sehen! " .. fam-text $) text! 
		($ "' EIGENSCHAFT: " pbold .. recruitee .trait@ $) +crtext 
		($ " '  VORTEIL: " pbold .. recruitee .perk@ $) +text 
			choice( "'Rekrutiert " .. rname .. " 'fur das Team" )choice: recruit-familiaryes
			choice( "'Verlasse " .. rname .. " 'zuruck" )choice
;

} }


