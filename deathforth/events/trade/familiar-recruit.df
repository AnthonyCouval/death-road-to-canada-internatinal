0 stack var familiar-stack

: .applyperk args( chara )
	0 6 rnd <- chara .wits! 0 6 rnd <- chara .attitude!
	0 6 rnd <- chara .composure! 0 6 rnd <- chara .loyalty!
	<- chara .perk@ dup "APLICANDO PERK: " type print perk-find dup if <- chara swap execute then
;

: .applytrait args( chara )
	<- chara .trait@ dup "APLICANDO TRAIT: " type print trait-find dup if <- chara swap execute then
;

: draw-familiar
	familiar-stack depths for
		pops #savechar-clone dup if
			nip #character
			dup .applyperk dup .applytrait
		then;
		drop
	next
	drop 0
;

cyoa{ road{

: fam-text
	0 stack
		($ rHe .. " 'no ha visto a " .. thegroup .. " ' todavia, y esta ocupado recogiendo " .. rhis .. " ' nariz." $) shove
		($ rHe .. " esta durmiendo en una mesa de picnic, justo a la vista." $) shove
		($ rHe .. " se encontro tratando de abrir una puerta que decia TIRE en ella." $) shove
		($ rHe .. " ' esta cantando un pequeno cancioncito, y no se ha percatado de " .. thegroup .. " ' aun." $) shove
		($ rHe .. " ' sera expulsada por " .. rhis .. " ' su antigua banda. Ellos parecen estar bastante enojados. " .. rname .. " 'frunce el ceno." $) shove
		($ rHe .. " ' dormia en una casa abandonada. " .. rHe .. " ' se enoja un poco de haberse despertado." $) shove
		($ rHe .. " ' esta sentada en un parque, leyendo un libro." $) shove
		($ rHe .. " ' estaba haciendo mucho ruido, jugando a una consola portatil a pleno volumen." $) shove
		($ rHe .. " ' esta comiendo una barra de dulce. Esas cosas todavia no han ido mal." $) shove
		($ rHe .. " ' se estira. Luego " .. rhe .. " ' se estira mas aun. Es una rutina de estiramiento elaborada." $) shove
		($ rHe .. "  'pokes the dirt with a stick. Maybe' " .. rhe .. " esta haciendo planes, tal vez solo esta jugando con la tierra con un palo." $) shove
		($ rHe .. " esta mirando un mapa, con una expresion de total confusion." $) shove
		($ rHe .. "  esta gritando a algunos sobrevivientes, porque se burlaron de el. " .. rhis .. " cabello" $) shove
		($ rHe .. "  esta pateando un coche en frustracion. El coche esta emitiendo columnas de humo." $) shove
		($ rHe .. " 'esta luchando contra un zombi, y de repente se cae y cana en una extrana equivocacion. " .. rHe .. " 'se enverguenza mucho cuando " .. rhe .. " 'se da cuenta de que " .. thegroup .. "." $) shove
		// ($ rHe .. " " $) shove
	shuffles pops nip
;

: familiar-carnut-yes
	perkdef{
		carnut-picker to starting-car
		starting-car get-car 
	}
;

cyoa: familiar-carnut-event
	"Dulce Viaje" cyoa-title! ricon
		($ rname .. " 'dijo que " .. rhe .. " 'tenia " .. rhis .. " 'su propio coche oculto a proximidad, y que es un " .. "'un auto muy dulce" pbold .. "querrias cambiar a " .. rname .. "'tu carro?" $) cyoa-text!
		choice( "Siguamos con el actual carro" )choice
		choice( "Cambiar al nuevo carro" )choice: familiar-carnut-yes
		
;

: familiar-recruit-check
	perkdef{
		recruitee carnut? if
			' familiar-carnut-event stack-road-action
		then 
	}
;

cyoa-choice: recruit-familiarreplace
	ricon
	($ cname .. " 'es sacado del grupo para dejar lugar a " .. rname .. "." $) cyoa-text!
	decruit-bad-silent-takeweapons 0.5 600 tone
	recruited
	familiar-recruit-check
;

: recruit-familiarreplace?
	' recruit-familiarreplace cyoa-team-choice
	choice( "Se va " .. rname .. " 'deja atras" )choice
;

cyoa: recruit-familiaryes
	team-full? if
		($ "El grupo esta lleno. Que persona quieres reemplazar para dejar lugar a " .. rname .. "?" $) cyoa-text!
			recruit-familiarreplace?
	then;
	ricon
	($ Thegroup .. " 'acepta " .. rname .. " 'se une al equipo!" $) cyoa-text! 2 300 tone
	recruited
	familiar-recruit-check
;

defer use-recruit-deck

cyoa: famevent
	"Caras Conocidas" cyoa-title!

	draw-familiar dup not if drop "NO HAY MAS PERSONAS!" text! use-recruit-deck then;

	to recruitee ricon

	($ "Whoa, es " .. rname .. "! Es agradable ver una cara familiar! " .. fam-text $) text! 
		($ "TRAITS: " pbold .. recruitee .trait@ $) +crtext 
		($ " ' PERK: " pbold .. recruitee .perk@ $) +text 
			choice( "Recluta " .. rname .. " ' al equipo" )choice: recruit-familiaryes
			choice( "Se va " .. rname .. " 'deja atras" )choice
;

} }


