uses paul/region-layout.df
"events/inner/clinicloc.df" $load

// "../deathforth/rooms/TEMPROOM.txt" $load-rooms
	
" 
:map 1 
:tags tradehospital  
:scriptA hospbag 
:scriptB hosptrader 
:scriptC regiondef{ trader-weapon-buyer-inside } 
:scriptD regiondef{ tnomey-spawn-inside } 
:scriptE hospitaldecomain 
:scriptF hospitaldecoside 
:scriptG hosptoilets 
:scriptH hospitalwall 
:size 45 22 
:off 0 0 
:tiles 
000000000000000000000000000000000000000222222
000002222222222222222222000000000000000233332
000002333332333332333332222222220000000211112
0000021E1EH2HEHE121EHE12333333320000000211112
00000211B11211B11211B1121111G1120000000211112
2222221111121111F2F11112111111120000000222222
233332F111F2F111121111F2111111120000000333333
2EHE12221222221222221222122222220000000000000
21B113331333331333331333133323330000000000000
211111H111H111111H111111111F20000000000000000
211111111111111111111111111120000000000000000
21F1F2222222221122222222222120000000000000000
222222333333321133333333333120000000000000000
333333000000021111111C11111120000000000000000
0000000000000211A1111111111120000000000000000
0000000000000211111111111D1120000000000000000
000000000000021111111111111120000000000000000
000000000000021122222222222220000000000000000
000000000000021123333333333330000000000000000
000000000000021120000000000000000000000000000
000000000000022220000000000000000000000000000
000000000000033330000000000000000000000000000

"
value TRADEHOSPITAL
TRADEHOSPITAL $parse-rooms

cyoa{

cyoa-choice: hosptrader1-go
	"FUR IMMER VERBRANNT" cyoa-title!
	($ "Der Arzt " .. cname .. "  einen kleinen Zettel aus. Darauf steht:	" .. "ur a dingus	u smell like egg" pbold $) cyoa-text!
	cchar statmod{ .fireproof? } not if
		"OH!
		OH! BURNED! OH!!!!!" fbold +crtext
		($ cname .. "  ist emotional am Boden zerstort von den Brandschaden dieses kranken Verbrennens! " 
		.. cname .. "' Haut fuhlt sich seltsam kuhl an." bbold $) +crtext
		cchar statmod{ .fireproof } morale4- badfx
		choice( "ARGH!" )choice
	else
		($ cname .. " ist feuerfest und von dieser Verbrennung uberhaupt nicht betroffen. " .. cname .. "  fuhlt sich dabei sehr selbstgefallig." bbold $) +crtext
		goodfx morale4+
		"NO! NO!
		NO! NO!!!!" fbold +crtext
		($ "Der Arzt flieht in groer Scham, und " .. cname .. "  reagiert indem er sofort den Raum plundert." $) +crtext
		deleteme +cr 6 8 rnd trunk-medical+
	then
	clear-cyoa
;

cyoa-bridge: hosptrader1-pick4
	ricon
	($ "Wer wird in die " .. "VERBRENNUNGSSTATION" .. fbold .. "?" $) cyoa-text!
	' hosptrader1-go cyoa-team-choice
;

cyoa: hosptrader1
	"Verbrennungsstation" cyoa-title!
	($ "WILLKOMMEN IN DER VERBRENNUNGSSTATION	WER WIRD VERBRANNT?" fbold $) cyoa-text!
	basic-tone
	choice( "Gehen Sie, nehmen Sie keinen Augenkontakt auf" )choice back-esc
	team-count 3 > if
		' hosptrader1-go 2 #cyoa-team-choice
		choice( "Wahle jemand anderen" )choice: hosptrader1-pick4
	else
		' hosptrader1-go cyoa-team-choice
	then
;

0 value ht2-1
0 value ht2-2
0 value ht2-3

cyoa-choice: trade-h2-3
	($ Thegroup .. "  kauft die " .. "MEDIZIN MEGAPAK!" fbold .. " ' Das ist eine Menge Heilpotenzial!	" .. "Das Heilspray XL hilft sogar bei verstauchten Zehen." pbold $) cyoa-text! goodfx
	10 WEAPON_HEALSPRAY trunk.weapon+ 10 trunk-medical+ -15 trunk-food+ someicon ' ht2-3 ++
;
	
cyoa-choice: trade-h2-2
	($ Thegroup .. "  kauft die " .. "GOLDENES SKALPELL" rbold .. ". Es bricht nie und trifft einen Zombie mit einem Schlag extrem hart fur eine Waffe, die mit maximaler Geschwindigkeit schwingt!" $) cyoa-text! goodfx ' ht2-2 ++
	1 WEAPON_GOLDSCALP trunk.weapon+ -15 trunk-food+ picon
;

cyoa-choice: trade-h2-1
	($ Thegroup .. "  kauft einen " .. "KNOCHENSAGE" rbold .. ". Es kann zwei Zombies mit einem Schlag treffen und trifft hart fur seine Geschwindigkeit." $) cyoa-text! goodfx ' ht2-1 ++
	1 WEAPON_BONESAW trunk.weapon+ -6 trunk-food+ picon
;

cyoa: hosptrader2
	"Medizinische Versorgung" cyoa-title!
	($ "Willkommen bei " pbold .. "Das ultimative Krankenhaus!" rainbold .. " ' Ich verkaufe lebenswichtige medizinische Versorgung, um euch auf eurer Reise zu helfen!" pbold $) cyoa-text!
	ht2-3 1 < if
		"Sonderangebot heute, eins pro Besuchergruppe: Mein Medizin Megapack enthalt 10 medizinische Hilfsmittel, zusatzlich zu einem Heilspray XL mit 10 Anwendungen!" pbold +crtext
	then
	basic-tone foodamt
	trunk-food 6 < if
		($ Thegroup .. " hat nicht genugend Nahrung um etwas zu kaufen!" $) +crtext
		($ "Der Handler gibt " .. thegroup .. "  eine kostenlose " .. "Knochenssage" rbold .. "  nur zum Besuch!" $) +crtext goodfx 1 WEAPON_BONESAW trunk.weapon+ clear-cyoa
	else
		choice( "Gehen Sie vorerst" )choice back-esc
		trunk-food 14 > ht2-3 1 < and if
			choice( "Medical Megapack   15 Essen" )choice: trade-h2-3
		then
		trunk-food 14 > ht2-2 1 < and if
			choice( "Goldenes Skalpell   15 Essen" )choice: trade-h2-2
		then
		trunk-food 5 > ht2-1 3 < and if
			choice( "Knochenensage   6 Essen" )choice: trade-h2-1
		then
	then
;

: issick? statmod{ .sick? } ; // The only time I ever use a sickness check, ever
: hospital-superserum
	' .strength++ foreach-team-char
	' .fitness++ foreach-team-char 
	' .vitality++ foreach-team-char 
	' .dexterity++ foreach-team-char
;

cyoa-choice: hosptrader3-go

	team-damage 0 = if
		($ Thegroup .. " ' wird untersucht, aber es ist nichts mit ihnen falsch. Der Arzt ist sichtlich wutend und beleidigt, dass du seine Zeit verschwendet hast, und kritzelt etwas in eine Tabelle." $) cyoa-text!
		morale++all
	else
		12 groupheal
		($ Thegroup .. "  wird wegen " $) cyoa-text!
		team-damage 1 < if 
			"alle" +text 
		else
			"die meisten" +text
		then
			"  ihrer Wunden." +text
			"Der Arzt ist unglaublich enttauscht und gelangweilt von deinen alltaglichen Verletzungen." +crtext
	then
	
	team-stack ' issick? stack-filter 0 > if 
		"ABER WARTET! " rbold +crtext
		($ "Der beunruhigte Genie Arzt entdeckt eine Krankheit! Nach etwa 44 Minuten kommt der Arzt zu einem aufregenden Schluss: Die Krankheit war " .. "KAFFEEVERGIFTUNG! " fbold $) +text
		($ "Der Arzt verabreicht ein experimentelles Wunder Superserum an " .. thegroup .. "'! Es heilt die Krankheit nicht, aber ein einziger Tag Ruhe wird das sowieso tun." $) +text +cr hospital-superserum
	then
	
	goodfx -5 trunk-food+ picon clear-cyoa
;

cyoa: hosptrader3
	"Wahrscheinlich ein beunruhigter Genie Arzt" cyoa-title!
	($ "'Ich behandle seit gefuhlt 6 Jahren nichts als Zombiebisse, leichte Verbrennungen, Propantankverletzungen und verstauchte Zehen. Sagt mir, dass ihr irgendeine Art von Krankheit habt. Idealerweise eine dramatische mysteriose Krankheit, aber selbst etwas wie eine Lebensmittelvergiftung ware toll an diesem Punkt. Alles auer einem weiteren Zombiebiss!" pbold $) cyoa-text!
	basic-tone +cr foodamt
	trunk-food 5 < if
		($ Thegroup .. "  hat nicht genugend Nahrung fur eine medizinische Behandlung!" $) +crtext
		($ "  Der Doktor erbarmt sich und verteilt ein paar medizinische Hilfsmittel " .. thegroup .. "  und verteilt ein paar medizinische Hilfsmittel." rbold $) +text goodfx 3 4 rnd trunk-medical+ clear-cyoa
	else
		choice( "Gehen Sie vorerst" )choice back-esc
			solo if
				choice( "Verletzungen behandeln lassen   5 Nahrung" )choice: hosptrader3-go
			else
				choice( "'Die Verletzungen der Gruppe behandeln lassen   5 Nahrung" )choice: hosptrader3-go
			then
	then
;

0 value cleaninglady-meals

: cleaninglady-amt cleaninglady-meals 20 * 10 + ;
: cleaninglady-pay? trunk-food cleaninglady-amt 1 - > ;
: cleaninglady-pay cleaninglady-amt -1 * trunk-food+ ;

cyoa-choice: cleaninglady-meal-eat
	cicon
	($ cname .. " ' ist uberflutet mit nostalgischen Aromen. Zuerst scheint das ganze Essen einen seltsamen, abgestandenen Nachgeschmack zu haben, aber man musste schon ein Narr sein, um zu glauben, dass dies nicht Absicht war. Es ist alles Teil des subtilen Reizes, der meisterhaften Gestaltung nicht als bloe Mahlzeit, sondern als ein totales Food Erlebnis!	Es gibt sogar ein zusatzliches Gelee! Eine rote Geschmacksrichtung, eine gelbe Geschmacksrichtung! Unglaublich!" $) cyoa-text!
	vitality++ morale4+ cchar .fullheal ' cleaninglady-meals ++
	goodfx
;

cyoa-bridge: cleaninglady-meal
	solo if
		soloer choosechar cleaninglady-meal-eat 
	else
		($ "Wer soll das Essen der Krankenhauscafeteria bekommen?" $) cyoa-text!
		"DIESES ESSEN DER GOTTER WIRD EINEN BONUS AUF DIE MAXIMALE GESUNDHEIT UND EINE MASSIVE MORALWIEDERHERSTELLUNG GEWAHREN!" rbold +crtext
			' cleaninglady-meal-eat cyoa-team-choice
	then
;

cyoa-bridge: cleaninglady-meal-pay
	cleaninglady-meal
	cleaninglady-pay
;

cyoa-bridge: cleaninglady-recruit
	ricon 4 recruitee .morale! clear-cyoa 0.25 recruitee .ai.wander_chance! 0 nearest .unseen!
	"Aufbereiten" cyoa-title!
	($ rname .. "  dreht ihren Mopp schnell um ihr Handgelenk.	" .. "Zeit dieses Durcheinander aufzuraumen!	" pbold .. "Wischwasser trankt " .. thegroup .. "  recht schlecht." $) cyoa-text!
	goodfx
	
	team-full? if
		($ "Die Gruppe ist voll.		Wen wurdest du gerne ersetzen um Platz fur " .. rname .. "?" $) +crtext
		recruit-replace?
	else
		recruited
		($ "Das schien wirklich einfach zu sein." $) +text
		most-charming if
			choosechar ($ cname .. "  uberzeugt " .. rhim .. "  um etwas Krankenhausessen herauszuschmuggeln!" $) +crtext
			choice( "GIB MIR DAS KRANKENHAUSESSEN" )choice: cleaninglady-meal
		then
	then
	
	// WEAPON_SHOTGUN recruitee .weaponb! 	20 LOOT_SHOTGUN_SHELL recruitee .lootamt!
;
		
cyoa: cleaninglady
	"Der Schwarzmarkt fur Cafeteria Essen" cyoa-title!
	nearest .character@ choosechar cchar to recruitee ricon
	($ "'Hier ist eine Putzfrau. Sie scheint nicht wirklich zu arbeiten. Sie mustert " .. thegroup .. " " $) cyoa-text! basic-tone
	cleaninglady-meals 0 > if
		"Aha. Wow, du hast ein ernstes Problem.		Ich kann dir ein weiteres besorgen, aber es wird dich etwas kosten."
	else
		"'Ich wei, warum du WIRKLICH hier bist. Du bist den ganzen Weg hierher gekommen, um das Krankenhausessen zu holen.		Ich kann dir die Cafeteriamahlzeit, nach der du dich sehnst, fur einen Preis besorgen." 
	then pbold +crtext +cr foodamt
	cleaninglady-pay? if
		choice( "Gehen Sie vorerst" )choice back-esc
		choice( "Kaufe sich Essen aus der Cafeteria   " .. cleaninglady-amt .. " nicht cafeteria Essen" )choice: cleaninglady-meal-pay
		choice( "Aus Prinzip verweigere ich das" )choice
	else
		choice( "'Kann das Essen nicht entbehren" )choice
	then
	choice( "Sie versuchen sie zu rekrutieren" )choice: cleaninglady-recruit
;

0 value hospital-medical+

: hospital-train-amt numhums 2 * hospital-medical+ 1 + * 1 + ; 
: hospital-train-pay? trunk-food hospital-train-amt 1 - > notsolo notsolohuman and and ;
: hospital-train-pay hospital-train-amt -1 * trunk-food+ ;

: hospital-solo-amt hospital-medical+ 2 * 3 + ;
: hospital-solo-pay? trunk-food hospital-solo-amt 1 - > ;
: hospital-solo-pay hospital-solo-amt -1 * trunk-food+ ;

cyoa-choice: hospital-medical-train
	cchar .medical@ 6 < if
		($ cname .. " hauptsachlich bekommt er hier eine Kursausbildung im Golf Trivia. Irgendwie fuhlt sich dies auf medizinische Fahigkeiten anwendbar.," $) goodfx
	else
		($ cname .. " sie haben bereits ihr vollstandiges medizinisches Diplom von SHBU erhalten!		Aber die Unser Heiliger der Krankenhaus Toilettenuniversitat stellt keine Ruckerstattungen aus.," $) badfx
	then cyoa-text! 
	hospital-solo-pay medicalREV medical++ ' hospital-medical+ ++
;

cyoa-choice: hospital-medical-group
	($ "'Die ganze Gruppe erhalt medizinische Ausbildung! Das ist fast ganz ein Gruppenspiel von richtigem Golftechnik.'" $) cyoa-text! goodfx
	hospital-train-pay someicon
	regiondef{ ' trade-medical-group! foreach-human-char } numhums ' hospital-medical+ +!
;

cyoa: hospital-medical-give
	solohuman if
		choosehuman hospital-medical-train
	then;
	"Wer soll diese umfassende medizinische Wissen erhalten?" cyoa-text!
	' hospital-medical-train cyoa-human-choice
;

cyoa: hosptrainer
	($ "Unser Heiliger Krankenhaus Toilettenuniversitat" $) cyoa-title!
	"'Feh! Arzte! Groes Thema! Ich kann Ihnen alles, was Sie uber Medizin wissen mussen, hier in dieser Toilette lehrreichender als in jeder Zitat unzitat UNIVERSITAT.'," pbold text!
	"'Spuck schiet aus ihrem Mund heraus, wenn sie sagen Universitat. Man frage sich, wie lange sie in dieser Toilette gewesen sind und ob sie ihre Hande gewaschen haben.'," +crtext foodamt
		hospital-solo-pay? not if
			"'Sie konnen sich kein weiteres Training leisten." +crtext 
		then;
		choice( "Gehen Sie vorerst" )choice back-esc
		hospital-solo-pay? if
			choice( "Gib " .. hospital-solo-amt .. "  essen fur Einzeltraining" )choice: hospital-medical-give
		then
		hospital-train-pay? if
			choice( "Gib " .. hospital-train-amt .. "  essen fur Gruppentraining" )choice: hospital-medical-group
		then
		
;
	
}

root{

: hosp-magchance
	20 %chance if
		magazine 0 4 rnd cyoa{ to bookmagtype ' bookmag-get cyoa! } 50 health! -2 movex drift
	then
;

}

roomgen{


: .ht1 args( ch ) 
	21 <- ch .specialhead! 24 <- ch .specialbody! // Jerk head, Madsci body, Burn Unit
;
: .ht2 args( ch ) 
	5 <- ch .hattype! 25 <- ch .glassestype! // Bandanna, Medical Supplies and Weapons
;
: .ht3 args( ch ) 
	6 <- ch .hattype! 10 <- ch .torsotype! // Beanie, Black Jacket, Group Heal
;

: hosptradercommon
	still-npc regiondef{ ' trader-event lt .events! 1 lt .timer! }
	
;

: hospitaldecomain 1 5 rnd case
	1 of hospitalshelfempty endof
	2 of hospitalbed endof
	3 of hospitalexam endof
	4 of hospitalbedside endof
	5 of wheelchair endof
endcase -10 movey ;

: hospitaldecoside 1 5 rnd case
	1 of ivpole endof
	2 of hospitalstool endof
	3 of hospitalstepper endof
	4 of hospitalcurtain endof
	5 of stretcher endof
endcase ;

: hosptoilets
	bathtoilet -1 movey 0.3 movex
	stall -1 movey 1 movex
	stall -1 movey -0.5 movex
	bathtoilet -1 movey 2 movex
	bathtoilet -1 movey -1.2 movex
	stall -1 movey -2 movex
	sink -1 movey -3 movex
	sink -1 movey -4 movex
	hosptradercommon 2 movey cyoa{ ' hosptrainer cyoa! }
	hosp-magchance
;

: hosptrader1
	hosptradercommon .ht1 cyoa{ ' hosptrader1 cyoa! }
;

: hosptrader2
	hosptradercommon .ht2 cyoa{ ' hosptrader2 cyoa! }
;

: hosptrader3
	hosptradercommon .ht3 cyoa{ ' hosptrader3 cyoa! }
;

: hosptrader4
	hosptradercommon .cleanerify cyoa{ ' cleaninglady cyoa! }
;

		0 stack
			' hosptrader1 shove
			' hosptrader2 shove
			' hosptrader3 shove
			' hosptrader4 shove
		value hosptrader-base
		hosptrader-base shuffles var hosptrader-picker

: hosptrader
	hosptrader-picker depths 0= if hosptrader-base shuffles to hosptrader-picker then pops nip execute ;

: hospbag
	bag-me ;

}

locdef{

location: tradehospital
		max-rooms: 1
		entry-tags: tradehospital
		script: set-theme-hospital
		pre-script: set-theme-hospital
		post-script: nad 0 %zombs
				
		room-choice: tradehospital
			room-weight: 10
			room-count: 1
			filter-only

}
				
map{ regiondef{

trade-camp-reset

: site-setup

	1 no_time!
	12 14 rnd o'clock
	
	mission{ no-edge-spawns }
	
;

	 region: specialcamp-7
		
		trade-mode

		inside
					
		loc-choice: tradehospital
			loc-weight: 99
			loc-count: 1

		post-script: site-setup
} }
