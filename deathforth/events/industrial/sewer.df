uses mission-events.df

cyoa{

// : cyoa-exit-ladder-go mission{ walk-try-end-mission } ;

cyoa: cyoa-exit-ladder
	"A Saida" cyoa-title!
	"'Encontrou a escada para fora!" cyoa-text!
	cyoa-add-choice
		"Suba!" cyoa-choice-text!
		mission{ ' walk-try-end-mission cyoa-choice-handler! }
		choice( "Fique por aqui por enquanto" )choice
;

: tutorial-ladder-end
	quit-to-title
	gstats{ ' tutorial-done ++ save }
;

cyoa: cyoa-exit-ladder-tutorial
	"Portugues" cyoa-title!
	($ "'Encontraste a escada para fora!	Isso encerrara a historia para voce mas sua historia esta prestes a comecar! Voce ira se dirigir para o Canada roubando tudo o que pode no caminho. Voce precisara construir suas habilidades e sua equipe para sobreviver! " .. pname .. "', mas sua historia esta prestes a comecar!	Voce ira se dirigir para o Canada, roubando tudo o que pode no caminho. Voce precisara construir suas habilidades e sua equipe para sobreviver!" $) cyoa-text!
	cyoa-add-choice
		"Encerrar Tutorial!" cyoa-choice-text!
		' tutorial-ladder-end cyoa-choice-handler!
		choice( "Fique por aqui por enquanto" )choice
;


}

: poswet? 16 / swap 16 / swap map{ tile@ .wet@ } ;

mission{
thing-event: ladder-glow-effect
	eventid THING_EVENT_TIMER <> if exit then
	particle{ new me .pos 7 + pos! 1 ticks! ticks@ fade_out!
//		1 madticks 120 * sin 0.025 * + scale! // shimmer
		1.25 scalex!
		particles_base_id 0x 51 + spriteid!
		0.75 clr.r! 0.5 clr.g! 0.125 clr.b!
		2 layer!
		glowy
		me .pos poswet? if
			madticks 5 * sin 0.05 * scalex@ + scalex!
			madticks 5 * cos 0.05 * scaley@ + scaley!
			madticks 13 * cos 0.025 * scale@ + scale!
		then
	}
	1 me .timer!
;
}

: exit-ladder-setup
	spawn special_objects32_base_id 0x 18 + lt .spriteid! immovable
	0 %flammability!
	0 lt .no_hit!

	map{ postify }
	// Make it squareish collision
 	4 lt .rad.x!
	4 lt .rad.y!

	mission{ ' ladder-glow-effect lt .events! }

	1 lt .timer!
;

: exit-ladder

	exit-ladder-setup
	cyoa{ ' cyoa-exit-ladder cyoa! }
;

: exit-ladder-tutorial

	exit-ladder-setup
	cyoa{ ' cyoa-exit-ladder-tutorial cyoa! }
;

: sewer-junktest
	spawn special_objects64_base_id 1 + lt .spriteid!
	0 %flammability! bbox immovable

;

cyoa{ road{

cyoa: sewer-test2
	
	"Rio da Morte" cyoa-title!
	someicon
	($ Thegroup .. " chega em uma grande cidade, conquistada pelos mortosvivos, e ve que " .. ghis .. "  so chance e enfrentando o sistema de esgotamento.	Ao abrir a manhole, um cacofonia de rugidos sai. Isso nao e uma boa sinal." $) cyoa-text! basic-tone
		1.3 18 20 rnd 2 3 rnd zforecast
		mission{ ' door-no-escape to main-event-mission-location-leave }
		"events/industrial/region/sewertest2.df" $load-region
		choice( "DIVERTASE NADANDO" )choice: premission
;

cyoa: sewer-test
	
	"Rio de Lama" cyoa-title!
	someicon
	($ "Esta cidade esta coberta por hordas de mortosvivos e lixo que foi tocado por um incendio anterior. " .. Thegroup .. " e cercado, e " .. ghis .. "  unica chance e " .. "CORRIGO PELA" fbold .. " 'os esgotos'" $) cyoa-text! basic-tone
		0.8 20 24 rnd 2 3 rnd zforecast
		mission{ ' door-no-escape to main-event-mission-location-leave }
		"events/industrial/region/sewertest.df" $load-region
		choice( "DIVERTASE NADANDO" )choice: premission
;

cyoa: rescuesewer
	
	"Resgate Fedido" cyoa-title!
	someicon
	($ Thegroup .. " 'Avista um sobrevivente desesperado fugir de uma horda pulando no esgoto. Ajudar envolveria ter que encontrar um jeito mais seguro de sair.'" $) cyoa-text! basic-tone
		0.9 1.2 frnd 19 22 rnd 2 3 rnd zforecast
		mission{ ' door-no-escape to main-event-mission-location-leave }
		"events/industrial/region/rescuesewer.df" $load-region
		choice( "Tente resgatar!" )choice: premission
		gas-draw
;

} }



