uses mission-events.df

cyoa{

// : cyoa-exit-ladder-go mission{ walk-try-end-mission } ;

cyoa: cyoa-exit-ladder
	"'Der Weg Aus" cyoa-title!
	"'Du hast die Leiter gefunden, um hier raus zu kommen!" cyoa-text!
	cyoa-add-choice
		"'Kletter hinaus!" cyoa-choice-text!
		mission{ ' walk-try-end-mission cyoa-choice-handler! }
		choice( "'Bleib fur jetzt" )choice
;

: tutorial-ladder-end
	quit-to-title
	gstats{ ' tutorial-done ++ save }
;

cyoa: cyoa-exit-ladder-tutorial
	"'Der Weg aus dem Tutorial" cyoa-title!
	($ "'Du hast die Leiter gefunden, um hier raus zu kommen! Dies beendet die Geschichte fur " .. pname .. "', aber deine Geschichte steht bevor! Du wirst deinen Weg nach Kanada machen, alles ausrauben, was du kannst, auf dem Weg. Du wirst deine Fahigkeiten und dein Team aufbauen mussen, um zu uberleben!" $) cyoa-text!
	cyoa-add-choice
		"'Tutorial beenden!" cyoa-choice-text!
		' tutorial-ladder-end cyoa-choice-handler!
		choice( "'Bleib fur jetzt" )choice
;


}

: poswet? 16 / swap 16 / swap map{ tile@ .wet@ } ;

mission{
thing-event: ladder-glow-effect
	eventid THING_EVENT_TIMER <> if exit then
	particle{ new me .pos 7 + pos! 1 ticks! ticks@ fade_out!
//		1 madticks 120 * sin 0.025 * + scale! // shimmer
		1.25 scalex!
		particles_base_id 0x 51 + spriteid!
		0.75 clr.r! 0.5 clr.g! 0.125 clr.b!
		2 layer!
		glowy
		me .pos poswet? if
			madticks 5 * sin 0.05 * scalex@ + scalex!
			madticks 5 * cos 0.05 * scaley@ + scaley!
			madticks 13 * cos 0.025 * scale@ + scale!
		then
	}
	1 me .timer!
;
}

: exit-ladder-setup
	spawn special_objects32_base_id 0x 18 + lt .spriteid! immovable
	0 %flammability!
	0 lt .no_hit!

	map{ postify }
	// Make it squareish collision
 	4 lt .rad.x!
	4 lt .rad.y!

	mission{ ' ladder-glow-effect lt .events! }

	1 lt .timer!
;

: exit-ladder

	exit-ladder-setup
	cyoa{ ' cyoa-exit-ladder cyoa! }
;

: exit-ladder-tutorial

	exit-ladder-setup
	cyoa{ ' cyoa-exit-ladder-tutorial cyoa! }
;

: sewer-junktest
	spawn special_objects64_base_id 1 + lt .spriteid!
	0 %flammability! bbox immovable

;

cyoa{ road{

cyoa: sewer-test2
	
	"'Fluss des Todes" cyoa-title!
	someicon
	($ Thegroup .. " ' trifft in einer riesigen Stadt ein, von Untoten erobert, und sieht, dass " .. ghis .. " ' einzige Chance ist, das Abwassersystem zu wagen. Wenn du den Gullydeckel offnest, dringen gequalte Schreie hervor. Das ist nicht unbedingt ein gutes Zeichen." $) cyoa-text! basic-tone
		1.3 18 20 rnd 2 3 rnd zforecast
		mission{ ' door-no-escape to main-event-mission-location-leave }
		"events/industrial/region/sewertest2.df" $load-region
		choice( "'TAUCHEN" )choice: premission
;

cyoa: sewer-test
	
	"'Fluss aus Schlamm" cyoa-title!
	someicon
	($ "'Diese Stadt ist von Horden von Untoten und Trummern ubersat, die von einem fruheren Brand beruhrt wurden. " .. Thegroup .. " ' wird eingekreist, und " .. ghis .. " 1/2 " .. "'SPRINGEND DURCH" fbold .. " 'im Abwasserleitungen." $) cyoa-text! basic-tone
		0.8 20 24 rnd 2 3 rnd zforecast
		mission{ ' door-no-escape to main-event-mission-location-leave }
		"events/industrial/region/sewertest.df" $load-region
		choice( "'TAUCHEN" )choice: premission
;

cyoa: rescuesewer
	
	"'Rettungsdienst mit Geruch" cyoa-title!
	someicon
	($ Thegroup .. " 'entdeckt einen verzweifelten Uberlebenden fluchten vor einer Horde, indem er ins Abwassergraben springt. Hilfe leisten wurde bedeuten, eine sichere Ausgangsmoglichkeit zu finden." $) cyoa-text! basic-tone
		0.9 1.2 frnd 19 22 rnd 2 3 rnd zforecast
		mission{ ' door-no-escape to main-event-mission-location-leave }
		"events/industrial/region/rescuesewer.df" $load-region
		choice( "'Rettungsversuch starten!" )choice: premission
		gas-draw
;

} }



