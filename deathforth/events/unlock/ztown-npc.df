cyoa{ road{ regiondef{

cyoa: info-dingus
	"wugh" cyoa-title!
	"'Hola, soy el Info Dingus" text!
;

uses events/unlock/perktrait.df
uses events/unlock/perk1.df
uses events/unlock/perk2.df
uses events/unlock/perk3.df
uses events/unlock/trait1.df
uses events/unlock/gnome.df
uses events/unlock/twitter.df

: challenge-gamemodecheck

	// Increment this 0 by 1 for each game mode with wins
	0 gstats{
		wins-normal		if 1+ then
		wins-long		if 1+ then
		wins-special	if 1+ then
		wins-family		if 1+ then
		wins-specialEX	if 1+ then
		wins-familyEX	if 1+ then
		wins-kepa		if 1+ then
		wins-short		if 1+ then
		wins-marathon	if 1+ then
		wins-deadlier	if 1+ then
		wins-endless	if 1+ then
		wins-opp		if 1+ then
		wins-quickdeath	if 1+ then
		wins-4jerks		if 1+ then
		wins-4jerksEX	if 1+ then
	}
;

cyoa: challenge-statue1
	gstats{ challenge-statue1 } 1 < if
		"DESAFIO DE MODOS I" cyoa-title!
		challenge-gamemodecheck 6 < if
			($ "Supera 6 modos de juego diferentes para " .. "desbloquear" rainbold .. " una variedad de " .. "9 SOMBREROS NUEVOS" rainbold .. " para el Creador de personajes personalizados!" $) text!
			($ "Modos de juego derrotados: " bbold .. challenge-gamemodecheck $) +crtext
		else
			($ "You've beaten 6 different game modes!
			" .. "DEFIRME EL RETO COMPLETO!" rainbold $) text!
			goodfx gstats{ 1 to challenge-statue1 } filesave{ save-global-stats }
			"Se han desbloqueado permanentemente nuevos sombreros. Verlos en el Creador de Personajes!" +crtext
			extrahatcheck
		then
	else
		"MODO DESAFIO I   COMPLETADO!" cyoa-title!
		($ "Despues de derrotar a 6 modos diferentes de juego, has obtenido una serie de 9 nuevos sombreros para el Creador de Personajes! Esto incluye algunos sombreros buscados:		" .. "BANO CON TANQUE Y COVERTA		CABEZA DE CABALLO		CORONA DORADA" rbold .. "		Y MAS!		" fbold $) text!
		extrahatcheck
	then
	choice( "VOLVER" )choice
;

cyoa: challenge-statue2
	gstats{ challenge-statue1 } 2 < if
		"MODO DESAFIO II" cyoa-title!
		challenge-gamemodecheck 10 < if
			($ "Derrota a 10 modos diferentes para " .. "desbloquear" rainbold .. " una variedad de " .. "6 NUEVOS SOMBREROS" rainbold .. "  y " .. "8 NUEVAS TINTAS" rainbold .. " para el Creador de personajes personalizados!" $) text!
			($ "Modos de juego derrotados: " bbold .. challenge-gamemodecheck $) +crtext
		else
			($ "You've beaten 10 different game modes!
			" .. "DEFIRME EL RETO COMPLETO!" rainbold $) text!
			goodfx gstats{ 2 to challenge-statue1 } filesave{ save-global-stats }
			"Se han desbloqueado permanentemente nuevos sombreros y tintas. Verlos en el Creador de Personajes!" +crtext
			extrahatcheck extraglassescheck
		then
	else
		"DESAFIO DE MODOS II   COMPLETO!" cyoa-title!
		($ "Despues de vencer 10 modos de juego diferentes, has ganado un lote de 6 sombreros nuevos y 8 tonos nuevos para el Creador de Personajes Personalizado! Esto incluye accesorios muy buscados como:" .. "SOMBRERO DE PRINCESA" rbold .. "		Y MAS!		" fbold $) text!
		extrahatcheck extraglassescheck
	then
	choice( "VOLVER" )choice
;

cyoa: challenge-statue3
	gstats{ challenge-statue1 } 3 < if
		"CHALLENGE OF MODES III" cyoa-title!
		challenge-gamemodecheck 14 < if
			($ "Vence 14 modos de juego diferentes para " .. "desbloquear" rainbold .. " una variedad de " .. "12 SOMBREROS NUEVOS" rainbold .. " para el Creador de personajes personalizados!" $) text!
			($ "Modos de juego derrotados: " bbold .. challenge-gamemodecheck $) +crtext
		else
			($ "You've beaten 14 different game modes!
			" .. "DEFIRME EL RETO COMPLETO!" rainbold $) text!
			goodfx gstats{ 3 to challenge-statue1 } filesave{ save-global-stats }
			"Se han desbloqueado permanentemente nuevos sombreros. Verlos en el Creador de Personajes!" +crtext
			extrahatcheck
		then
	else
		"CHALLENGE OF MODES III - COMPLETE!" cyoa-title!
		($ "Despues de vencer 14 modos de juego diferentes, has ganado un lote de 12 sombreros nuevos para el Creador de Personajes Personalizado! Esto incluye sombreros muy buscados como:" .. "'PEZ GRANDE		TAM O' SHANTER		BOTA DE CABEZA		SOMBRERO DE CHEF" rbold .. "		Y MAS!		" fbold $) text!
		extrahatcheck
	then
	choice( "VOLVER" )choice
;

cyoa: challenge-statue4
	gstats{ challenge-statue1 } 4 < if
		"DESAFIO DE MODOS IV" cyoa-title!
		gstats{ best-gamemode-streak 4 } > challenge-gamemodecheck 13 > and if
			($ "You've streaked 5 different game modes!
			" .. "DEFIRME EL RETO COMPLETO!" rainbold $) text!
			goodfx gstats{ 4 to challenge-statue1 } filesave{ save-global-stats }
			"Se han desbloqueado permanentemente nuevos sombreros. Verlos en el Creador de Personajes!" +crtext
			extrahatcheck
		else
			($ "Despues de superar los desafios anteriores, consigue una racha ganadora de 5 modos de juego diferentes para " .. "desbloquear" rainbold .. " una variedad de " .. "18 SOMBREROS NUEVOS" rainbold .. " para el Creador de personajes personalizados!" $) text!
			($ "Modos de juego derrotados: " bbold .. challenge-gamemodecheck $) +crtext
			($ "Mejor racha de diferentes modos de juego " bbold .. gstats{ best-gamemode-streak } $) +crtext
		then
	else
		"DESAFIO DE MODOS IV   COMPLETO!" cyoa-title!
		($ "Despues de lograr una racha de 5 modos de juego diferentes, has ganado un lote de 18 sombreros nuevos para el Creador de Personajes Personalizado! Esto incluye sombreros muy buscados como:" .. "GORRA DE GNOMO		SOMBRERO DE PAPEL DE ALUMINIO		MASCARA DE CARTON		SOMBRERO DE BRUJO" rbold .. "		Y MAS!		" fbold $) text!
		extrahatcheck
	then
	choice( "VOLVER" )choice
;

cyoa: jerk-dingus
	"La tienda de idiotas llamo" cyoa-title!
	"'ERES UN IDIOTA OK, ESO SERAN CINCO DOLARES! GRACIAS POR COMPRAR EN LA TIENDA DE IDIOTAS" text!
	choice( "'ESTAN TODOS FUERA DE USTED" )choice
;

cyoa: roaming-capyrun
	"El roedor errante" cyoa-title!
	($ "La cosa del roedor " .. "(Capybara? Cobaya muy grande?)" pbold .. "  huye cuando te acercas. Corre hacia el " .. "NORESTE!" rainbold $) text!
	clear-cyoa deleteme
;

cyoa: ugnome-note
	"Desde el escritorio de Unomey" cyoa-title!
	($ "La nota dice lo siguiente:" $) cyoa-text! 
	"SAL DE MI CASA, NERD!" pbold +crtext
;

// : tutorial-repeat 0 saveslot! MAIN_EVENT_NEW main-post-event "events/tutorial.df" $load-region to-mission ;
: tutorial-repeat 0 saveslot! gstats{ 0 to tutorial-done save } sys_reset ;

cyoa: tutorial
	"Tutorial" $upper cyoa-title!
	someicon
	($ "Puedes repetir el tutorial aqui!	Esto es util si te perdiste informacion sobre cosas como dejar caer armas o tirar muebles.	Esta opcion te regresara a la pantalla de titulo, solo presiona INICIO para ingresar al tutorial nuevamente." $) cyoa-text! basic-tone
	
		choice( "SALIR" )choice
		choice( "Repetir tutorial" )choice: tutorial-repeat
;

: dingus-deleted-dialog
	FLASHY "BORRADO!" .. $cyoa-ok-dialog "Dingus" $upper cyoa-title!
;

: deletedata-gstats gstats{ gstats-clear } sys_reset 5 0.95 2dup rumble-camera rumble-gui sfx{ rumble } dingus-deleted-dialog ;
: deletedata-custchars filesave{ custchars-clear save-custchars load-custchars } dingus-deleted-dialog sfx{ creepy } ;
: deletedata-both deletedata-custchars deletedata-gstats ;

cyoa-blank: deletedata-gstats-confirm
	"Estas seguro de que quieres eliminar tus estadisticas, ventajas y rasgos? Esto tambien eliminara cosas como el progreso del modo de juego." text!
	"NOTA: Seleccionar esta opcion saldra a la pantalla de titulo." pbold +crtext
	choice( "NO" )choice
	choice( "SI, ELIMINARLOS" )choice: deletedata-gstats
;

cyoa-blank: deletedata-custchars-confirm
	"Estas seguro de que quieres eliminar todos tus personajes personalizados?" text!
	choice( "NO" )choice
	choice( "SI, ELIMINARLOS" )choice: deletedata-custchars
;

cyoa-blank: deletedata-both-confirm
	"Estas seguro de que quieres eliminar estadisticas, ventajas, rasgos y tus personajes personalizados? Esto tambien eliminara cosas como el progreso del modo de juego." text!
	"NOTA: Seleccionar esta opcion saldra a la pantalla de titulo." pbold +crtext
	choice( "NO" )choice
	choice( "SI, ELIMINAR TODO" )choice: deletedata-both
;

// Do ARE YOU SURE? choices too
cyoa: deletedata
	"Borrar datos" $upper cyoa-title!
	"'SOY EL DINGUS DE ELIMINACION DE DATOS! ELIMINARE TODOS TUS DATOS!" rbold text!
	"'El esqueleto hace ruidos de traqueteo. Puedes eliminar los datos de tu juego aqui! Aunque, probablemente no deberias." +crtext
	choice( "SALIR" )choice
	choice( "Personajes Personalizados" )choice: deletedata-custchars-confirm
	choice( "Estadisticas y ventajas" )choice: deletedata-gstats-confirm
	choice( "Borrar ambos" )choice: deletedata-both-confirm
; 

cyoa-blank: freeZP-give-go
	iicon
	"PUNTOS ZOMBO aumentaron a 99!" rainbold text!
	goodfx gstats{ 99 to zombo-point save }
	
;

cyoa: freeZP-give
	"Regalo de puntos Zombo!" cyoa-title! iicon
	"'BUENO ES LA RAMA DE PRUEBAS ASI QUE PUEDO DARTE ALGUNOS PUNTOS ZOMBO" bbold text!
	gstats{ zombo-point } 99 < if 
		choice( "Dame esos puntos Zombo" )choice: freeZP-give-go
	else
		"VUELVE CUANDO TENGAS MENOS DE 99 ZP!" bbold
	then +crtext
	choice( "Dejalo por ahora" )choice
	
;

} } }

map{ regiondef{

: info-dingus
	nomove-npc
	40 lt .character@ .specialtype!
	' infostats lt .cyoa!
;

: tutorial-dingus
	nomove-npc
	10 lt .character@ .specialtype!
	' tutorial lt .cyoa!
;

: delete-dingus
	nomove-npc
	78 lt .character@ .specialtype!
	' deletedata lt .cyoa!
;

: perk-event args( me eventid perk ) THING_EVENT_TIMER <- eventid <> if then;

	<- me .cyoa@ 0= if then; // Just time out, don't display icon anymore

	15 <- me .repeating_timer

	<- me .nearest? if "" <- me .report then;

	// <- me .loot@ dup 0= if drop 1 GREEN "$" .. else looticon then
	// <- me GREEN "11" .. looticon - a ?
	
	<- perk 1 < if
		<- me "?" pbold
	else
		<- me <- perk bbold
	then 1 swap <- me .reportdurnow
;


(*
	EXAMPLE USAGE: Create a new event handler for the specified value

	gstats{ toilets-opened } pe: perk-event-toilet
*)

: pe: token $create last >body ! does> @ execute perk-event ;

: gstat: postpone gstats{ postpone ' postpone } ;

gstats{ ' perk1-stockleft } pe: perk1-stockleft-event
gstat: perk2-stockleft pe: perk2-stockleft-event
gstat: perk3-stockleft pe: perk3-stockleft-event
gstat: trait1-stockleft pe: trait1-stockleft-event
gstat: gnome-stockleft pe: gnome-stockleft-event
gstat: twitter-twitsleft pe: twitter-twitsleft-event

: total-unlocktally gstats{ perk1-unlocktally perk2-unlocktally perk3-unlocktally trait1-unlocktally + + + } ;
// 14 right now without any unlocked, has to be increased if new perks are added that are pre-unlocked

: total-upgradetally gstats{ perk1-upgradetally perk2-upgradetally perk3-upgradetally + + } ;
// 23 with nothing unlocked currently.
// Need to upgrade zombotown.df if either upgradetally or unlocktally changes.

: unlocker-shared
	// new-camper
	nomove-npc
	// 0.01 lt .character@ .ai.wander_chance!
	1 lt .timer!
;

: perk-dingus unlocker-shared
		
	57 lt .character@ .specialtype!
	' perk1-stockleft-event lt .events!
	' perk-dingus lt .cyoa!
;

: perk1-dingus unlocker-shared
		
	12 lt .character@ .specialtype!
	' perk1-stockleft-event lt .events!
	' perk1-dingus lt .cyoa!
;

: perk2-dingus unlocker-shared
		
	25 lt .character@ .specialtype!
	' perk2-stockleft-event lt .events!
	' perk2-dingus lt .cyoa!
;

: perk3-dingus unlocker-shared
		
	46 lt .character@ .specialtype!
	' perk3-stockleft-event lt .events!
	' perk3-dingus lt .cyoa!
;

: trait1-dingus unlocker-shared
		
	24 lt .character@ .specialtype!
	' trait1-stockleft-event lt .events!
	' trait1-dingus lt .cyoa!
;

: jerk-dingus
	// new-camper
	nomove-npc
	21 lt .character@ .specialtype!
	
	' trader-event lt .events!
	1 lt .timer!

	' jerk-dingus lt .cyoa!
;

: challenge-statue1 
	spawn special_objects48_base_id 0x 24 + 2 + lt .spriteid! bbox immovable
	' challenge-statue1 lt .cyoa!
;

: challenge-statue2
	spawn special_objects48_base_id 0x 24 + 1 + lt .spriteid! bbox immovable
	' challenge-statue2 lt .cyoa!
;

: challenge-statue3
	spawn special_objects48_base_id 0x 24 + 3 + lt .spriteid! bbox immovable
	' challenge-statue3 lt .cyoa!
;

: challenge-statue4
	spawn special_objects48_base_id 0x 24 + 0 + lt .spriteid! bbox immovable
	' challenge-statue4 lt .cyoa!
;

: generalinfo-duder
	nomove-npc
	' gameinfo lt .cyoa!
;

: unlockgnome unlocker-shared
	lt .character@ .gnomify2
	' gnome-stockleft-event lt .events!
	' unlockgnome lt .cyoa!	
;

: ugnome-note wrotenote cyoa{ ' ugnome-note cyoa! } ;

: unlockgnome-hut gstats{ ugnome-found } 1 < if unlockgnome else ugnome-note then ;
: capy-gnort args( me )
	<- me ($ "*GNORT*" rbold $) <- me
	.sprayit
	// statmod{ .report } clear-cyoa
	sfx{ sing 500 fx .d! 2.25 fx .pitch! 0.9 fx .q! <- me .adjust-vol } 
;

: capy-chat args( me )
	gstats{ ugnome-found } 0 > if
		<- me capy-gnort
	else
		cyoa{ roaming-capyrun }
	then
	; 

: roaming-capybara
	new-camper lt .character@ .gerbilfy
	// 0.06 lt .character@ .ai.wander_chance!
	' capy-chat lt .cyoa!
;

: hut-capybara
	new-npc lt .character@ .gerbilfy
	' capy-gnort lt .cyoa!
;

: freeZP-dingus
	nomove-npc 
	40 lt .character@ .specialtype!
	
	' trader-event lt .events!
	1 lt .timer!
	' freeZP-give lt .cyoa!
;

: twitter-chicken
	nomove-npc
	lt .character@ .chickenify
	300 angle-colour 2 rgb* lt .clr!

	' twitter-twitsleft-event lt .events!
	1 lt .timer!
	' twitterbird lt .cyoa!
;

} }

// MANDIBLE

cyoa{ regiondef{

cyoa: sycamore-dingus
	"Profesor Sicomoro" cyoa-title!
	"'No digas madera, me trae malos recuerdos." pbold text!
	"--- Professor Sycamore
	Creator of: Death Road to Sycamore" +crtext
	"Contribuciones para la actualizacion de MANDIBULA " rbold +crtext
	"Punch Bot y Speed Bot en el campamento especial de intercambio mecanico" bbold +crtext
	choice( "Robots muy simpaticos" )choice
;

cyoa: modguard-dingus
	"Cabana dentro de una cabana" cyoa-title!
	"Soy el guardian de la cabana de los contribuyentes! Mas alla de mi hay creadores que han contribuido con contenido nuevo a Death Road Son creadores de mods de Death Road to Canada de nuestro Discord " text! "#mod showcase" pbold +text "  y " +text "#deathroad modding" pbold +text 
	
	"Entra para leer sus palabras de inspiracion y descubrir lo que han anadido en cada actualizacion! Es una cabana dentro de la cabana de informacion mas grande!" +crtext
	choice( "'Echemos un vistazo a esta cabana" )choice
;

} }

map{ regiondef{

: sycamore-dingus
	// new-camper
	nomove-npc
	121 lt .character@ .specialtype!

	' sycamore-dingus lt .cyoa!
;

: modder-dingus
	// new-camper
	nomove-npc
	120 lt .character@ .specialtype!

	' modguard-dingus lt .cyoa!
;


} }
